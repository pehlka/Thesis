---
title: "Lab_data_w/o_no-standstill_starts"
author: "Kayla Pehl"
date: "10/1/2020"
output: html_document
---

# This dataset does NOT include trials where the lizard did not start from a standstill

```{r}
#Importing data and required packages

lab.data <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.15.20_removed_non-standstill_starts+NAs+negatives.csv")

#Creating new data frame without N/A's in bipedal percent column    
##148 rows in lab.data and 88 rows in lab.data_omit, so 60 trials didn't contain bipedalism but 88 did 
lab.data_omit <- lab.data[!is.na(lab.data$bipedal_percent), ]

fieldspeed_final <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final.csv")

library(ggplot2)
library(rcompanion)
library(lme4)
library(sjstats)
library(doBy)
library(car)
library(emmeans)
library(multcompView)
library(nlme)
library(lmtest)
```

```{r}
#Checking to see if all data is in correct formats (i.e. factor vs. numeric)    

is.factor(lab.data$ID)
is.factor(lab.data$sex)
is.factor(lab.data$substrate_type)
is.numeric(lab.data$pauses_side)
is.numeric(lab.data$pauses_top)
is.factor(lab.data$bipedal_quad_side)
is.factor(lab.data$bipedal_quad_top)
is.numeric(lab.data$bipedal_side)
is.numeric(lab.data$bipedal_top)
is.numeric(lab.data$total_video_frames)
is.numeric(lab.data$bipedal_percent)
is.factor(lab.data$no_start_from_standstill)
is.factor(lab.data$stops_before_end_of_racetrack)
is.numeric(lab.data$calibration)
is.numeric(lab.data$side_amax)
is.numeric(lab.data$side_pmax)
is.numeric(lab.data$side_posmax)
is.numeric(lab.data$side_spline_tol)
is.numeric(lab.data$side_tmax)
is.numeric(lab.data$side_vmax)
is.numeric(lab.data$top_amax)
is.numeric(lab.data$top_pmax)
is.numeric(lab.data$top_posmax)
is.numeric(lab.data$top_spline_tol)
is.numeric(lab.data$top_tmax)
is.numeric(lab.data$top_vmax)

#All are correct. Therefore nothing in dataset needs to change.
```


#Getting a feel for the data

```{r}
#Summary of data
summary(lab.data)
```

```{r}
#Number of Pauses
table(lab.data$pauses_side)
table(lab.data$pauses_top)
```
```{r}
#Runs per lizard on each substrate type
table(lab.data$ID, lab.data$substrate_type)

#using this data set (without no-standstill starts), lizard F has no runs for D or s, lizard N has no runs for D, and lizard P has no runs for D; all other lizards have at least 1 run for each of the substrates
```
> should this impact the dataset I use? (not using no-standstill starts currently)?
>> Eric said to do data work up using these 3 lizards and then when I'm done I'll need to go back and run stats without the 3 lizards and then compare the results; if the results are the same, we can run the stats including the 3 lizards, if not, we'll have to decide how to proceed


```{r}
#Females vs males count
table(lab.data$sex)
#70% runs are female, 30% are male
#15 females, 7 males

#7 males, 12 females - in final data set once 3 were removed that didn't have good runs on all 3 substrates
```



> Creating histograms to see distribution of data

#Max acceleration
```{r}
#Side max acceleration per substrate 
ggplot(data = lab.data, aes(side_amax))  + 
  geom_histogram(fill="orange", bins = 20, binwidth = 10) +
  facet_wrap(~substrate_type) +
  labs(title = "Side max acceleration per substrate")

#mean, median & range of side_amax data separated into substrate types
summaryBy(side_amax ~ substrate_type, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Side max acceleration per sex
ggplot(data = lab.data, aes(side_amax))  + 
  geom_histogram(fill="orange", bins = 20, binwidth = 5) +
  facet_wrap(~sex) +
  labs(title = "Side max acceleration per sex")

#mean, median & range of side max acceleration separated into sex
summaryBy(side_amax ~ sex, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Top max acceleration per substrate 
ggplot(data = lab.data, aes(top_amax))  + 
  geom_histogram(fill="purple", bins = 30, binwidth = 10) +
  facet_wrap(~substrate_type) +
  labs(title = "Top max acceleration per substrate")

#mean, median & range of top max acceleration separated into substrate types
summaryBy(top_amax ~ substrate_type, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Top max acceleration per sex
ggplot(data = lab.data, aes(top_amax))  + 
  geom_histogram(fill="purple", bins = 30, binwidth = 5) +
  facet_wrap(~sex) +
  labs(title = "Top max acceleration per sex")

#mean, median & range of top max acceleration separated into sex
summaryBy(top_amax ~ sex, data = lab.data,
          FUN = list(mean, median, min, max))
```


#Max velocity
```{r}
#Side max velocity per substrate 
ggplot(data = lab.data, aes(side_vmax))  + 
  geom_histogram(fill="orange", bins = 10) +
  facet_wrap(~substrate_type) +
  labs(title = "Side max velocity per substrate")

#mean, median & range of side_vmax data separated into substrate types
summaryBy(side_vmax ~ substrate_type, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Side max velocity per sex
ggplot(data = lab.data, aes(side_vmax))  + 
  geom_histogram(fill="orange", bins = 10) +
  facet_wrap(~sex) +
  labs(title = "Side max velocity per sex")

#mean, median & range of side vmax velocity separated into sex
summaryBy(side_vmax ~ sex, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Top max velocity per substrate 
ggplot(data = lab.data, aes(top_vmax))  + 
  geom_histogram(fill="purple", bins = 10) +
  facet_wrap(~substrate_type) +
  labs(title = "Top max velocity per substrate")

#mean, median & range of top max velocity separated into substrate types
summaryBy(top_vmax ~ substrate_type, data = lab.data,
          FUN = list(mean, median, min, max))
```

```{r}
#Top max velocity per sex
ggplot(data = lab.data, aes(top_vmax))  + 
  geom_histogram(fill="purple", bins = 10) +
  facet_wrap(~sex) +
  labs(title = "Top max velocity per sex")

#mean, median & range of top max velocity separated into sex
summaryBy(top_vmax ~ sex, data = lab.data,
          FUN = list(mean, median, min, max))
```



#Bipedalism Percentage
```{r}
#Bipedalism percentage per sex Histogram
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(fill="dark green", bins = 20, binwidth = 10) +
  facet_wrap(~sex)

#mean, median & range of bipedal percentage separated into sex
summaryBy(bipedal_percent ~ sex, data = lab.data_omit,
          FUN = list(mean, median, min, max))

#males are bipedal a lot more than females
```

```{r}
#Bipedalism percentage per substrate Histogram
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(fill="dark green", bins = 20, binwidth = 10) +
  facet_wrap(~substrate_type)

summaryBy(bipedal_percent ~ substrate_type, data = lab.data_omit,
          FUN = list(mean, median, min, max))

#lizards are a lot more likely to run bipedal on debris than sand
```


```{r}
#Bipedalism percentage per substrate and sex Histogram
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(fill="dark green", bins = 20, binwidth = 10) +
  facet_wrap(~substrate_type + sex) +
  facet_grid(sex ~ substrate_type)

#mean, median & range of bipedal percentage separated into substrate type
summaryBy(bipedal_percent ~ substrate_type + sex, data = lab.data_omit,
          FUN = list(mean, median, min, max))

#males are bipedal more often on every substrate than females

##for final manuscript, change plot titles to actual names instead of letters
### https://www.zevross.com/blog/2019/04/02/easy-multi-panel-plots-in-r-using-facet_wrap-and-facet_grid-from-ggplot2/ 
```


```{r}
#Boxplots of Bipedalism on acceleration 

ggplot(data = lab.data, aes(x=bipedal_quad_side, y=side_amax)) +
  geom_boxplot() +
    labs(title = "Bipedalism effect on max acceleration (side)")

ggplot(data = lab.data, aes(x=bipedal_quad_top, y=top_amax)) +
  geom_boxplot() +
    labs(title = "Bipedalism effect on max acceleration (top)")
```

```{r}
#Boxplots of Bipedalism on velocity

ggplot(data = lab.data, aes(x=bipedal_quad_side, y=side_vmax)) +
  geom_boxplot() +
    labs(title = "Bipedalism effect on max velocity (side)")

ggplot(data = lab.data, aes(x=bipedal_quad_top, y=top_vmax)) +
  geom_boxplot() +
    labs(title = "Bipedalism effect on max velocity (top)")
```


#Pmax, Posmax, Tmax
```{r}
#Histograms of pmax, posmax and tmax
ggplot(data = lab.data, aes(side_pmax)) +
  geom_histogram(fill = "dark blue") +
    labs(title = "Side Pmax")                     #skewed right

ggplot(data = lab.data, aes(side_posmax)) +
  geom_histogram(fill = "dark blue") +
    labs(title = "Side Posmax")                   #skewed left

ggplot(data = lab.data, aes(side_tmax)) +
  geom_histogram(fill = "dark blue") +
    labs(title = "Side Tmax")

ggplot(data = lab.data, aes(top_pmax)) +
  geom_histogram(fill = "medium blue") +
    labs(title = "Top Pmax")                      #skewed right

ggplot(data = lab.data, aes(top_posmax)) +
  geom_histogram(fill = "medium blue") +
    labs(title = "Top Posmax")

ggplot(data = lab.data, aes(top_tmax)) +
  geom_histogram(fill = "medium blue") +
    labs(title = "Top Tmax")                      #skewed right
```

```{r}
#Looking at bipedal vs. quadrupedal percentages from side and top

table(lab.data$bipedal_quad_side)
#42.6% bipedal on side runs, 57.4% quadrupedal on side runs

table(lab.data$bipedal_quad_top)
#53.3% bipedal on top runs, 46.7% quadrupedal on top runs
```


# Checking for normality

```{r}
#Checking for normality of data: max accelerations and velocities

#histograms
ggplot(data = lab.data, aes(side_amax))  + 
  geom_histogram(bins = 11, col = ("grey")) +
  labs(title = "Side Amax")                        #looks pretty normal

ggplot(data = lab.data, aes(top_amax))  + 
  geom_histogram(bins = 11, col = ("grey")) +
  labs(title = "Top Amax")                         #looks skewed right

ggplot(data = lab.data, aes(side_vmax))  + 
  geom_histogram(bins = 13, col = ("grey")) +
  labs(title = "Side Vmax")                        #looks fairly normal

ggplot(data = lab.data, aes(top_vmax))  + 
  geom_histogram(bins = 11, col = ("grey")) +
  labs(title = "Top Vmax")                         #looks skewed left

#Shapiro-Wilks normality test (p-value >0.05 assumes normality)
shapiro.test(lab.data$side_amax)
shapiro.test((lab.data$top_amax))
shapiro.test((lab.data$side_vmax))
shapiro.test(lab.data$top_vmax)

#side_amax: not normal
#top_amax: not normal
#side_vmax: normal
#top_vmax: normal
```

```{r}
#Checking for normality of data: time and position

#histograms
ggplot(data = lab.data, aes(side_tmax))  + 
  geom_histogram(bins = 11, col = ("grey")) +
  labs(title = "Side Tmax")                           #looks skewed right

ggplot(data = lab.data, aes(top_tmax))  + 
  geom_histogram(bins = 11, col = ("grey")) +
    labs(title = "Top Tmax")                          #looks skewed right

ggplot(data = lab.data, aes(side_posmax))  + 
  geom_histogram(bins = 13, col = ("grey")) +
    labs(title = "Side Posmax")                       #looks fairly normal

ggplot(data = lab.data, aes(top_posmax))  + 
  geom_histogram(bins = 30, col = ("grey")) +
    labs(title = "Top Posmax")

#Shapiro-Wilks normality test (p-value >0.05 assumes normality)
shapiro.test(lab.data$side_tmax)
shapiro.test((lab.data$top_tmax))
shapiro.test((lab.data$side_posmax))
shapiro.test(lab.data$top_posmax)

#side_tmax: not normal
#top_tmax: not normal
#side_posmax: normal
#top_posmax: not normal
```

```{r}
#Checking for normality of data: bipedal_side and bipedal_top

#histograms
ggplot(data = lab.data_omit, aes(bipedal_side))  + 
  geom_histogram(bins = 20, col = ("grey"))

ggplot(data = lab.data_omit, aes(bipedal_top))  + 
  geom_histogram(bins = 20, col = ("grey"))

#Shapiro-Wilks normality test (p-value >0.05 assumes normality)
shapiro.test(lab.data_omit$bipedal_side)
shapiro.test((lab.data_omit$bipedal_top))

#bipedal_side: normal
#bipedal_top: not normal
```



> Looking at diagnostics data

```{r}
#Top max acceleration vs. bipedalism in top

top.amax.biped <- lm(top_amax ~ bipedal_top, data = lab.data)
res.top.amax.biped <- resid(top.amax.biped)
plot(fitted(top.amax.biped), res.top.amax.biped)
abline(0,0)

qqnorm(res.top.amax.biped)
qqline(res.top.amax.biped,
       col = 'red')
plot(density(res.top.amax.biped))

plot(top.amax.biped)

#QQ plot shows data is skewed left -- need to transform
```

```{r}
#Side camera max acceleration vs. bipedalism in side
side.amax.biped <- lm(side_amax ~ bipedal_side, data = lab.data)
res.side.amax.biped <- resid(side.amax.biped)
plot(fitted(side.amax.biped), res.side.amax.biped)

qqnorm(res.side.amax.biped)
qqline(res.side.amax.biped,
       col = 'red')
plot(density(res.side.amax.biped))

plot(side.amax.biped)

#QQ plot maybe slightly skewed left - need to transform
```

```{r}
#Top max velocity vs. bipedalism in top
top.vmax.biped <- lm(top_vmax ~ bipedal_top, data = lab.data)
res.top.vmax.biped <- resid(top.vmax.biped)
plot(fitted(top.vmax.biped), res.top.vmax.biped)

qqnorm(res.top.vmax.biped)
qqline(res.top.vmax.biped,
       col = 'red')
plot(density(res.top.vmax.biped))

plot(top.vmax.biped)

#QQ plot maybe slightly skewed left but it looks pretty close to normal
```

```{r}
#Side max velocity vs. bipedalism in side
side.vmax.biped <- lm(side_vmax ~ bipedal_side, data = lab.data)
res.side.vmax.biped <- resid(side.vmax.biped)
plot(fitted(side.vmax.biped), res.side.vmax.biped)

qqnorm(res.side.vmax.biped)
qqline(res.side.vmax.biped,
       col = 'red')
plot(density(res.side.vmax.biped))

plot(side.vmax.biped)

#QQ plot looks pretty close to normal 
```


#Trying to determine if v_max needs to be transformed or not

```{r}
#Log transform side max velocity vs. bipedalism in side

log_side_vmax <- log(lab.data$side_vmax)
log.side.vmax.biped <- lm(log_side_vmax ~ bipedal_side, data = lab.data)
res.log.side.vmax.biped <- resid(log.side.vmax.biped)
plot(fitted(log.side.vmax.biped), res.log.side.vmax.biped)

shapiro.test(res.log.side.vmax.biped)
hist(log_side_vmax)

qqnorm(res.log.side.vmax.biped)
qqline(res.log.side.vmax.biped,
       col = 'red')
plot(density(res.log.side.vmax.biped))  #QQ plot looks pretty close to normal

plot(log.side.vmax.biped)

ggplot(data = lab.data, aes(log_side_vmax))  + 
  geom_histogram(bins = 13, col = ("grey"))    #skewed left

plot(lm(side_vmax ~ bipedal_side, data = lab.data))  #Side vmax vs. bipedalism

#Q-Q plots of regular and log-transformed side vmax data look basically the same to me. I'm not sure if log-transforming did a lot for the data.
```


```{r}
# Added this section during meeting with Eric

#log transform each variable!
#probably need to log transform all variables and then check residuals
#levene's test

log_side_amax <- log10(lab.data$side_amax+1)
log.side.amax.biped <- lm(log_side_amax ~ bipedal_side, data = lab.data)
res.log.side.amax.biped <- resid(log.side.amax.biped)
plot(fitted(log.side.amax.biped), res.log.side.amax.biped)


shapiro.test(res.log.side.amax.biped)
hist(res.log.side.amax.biped)

leveneTest(log_side_amax, lab.data$bipedal_side)
```

```{r}
#Comparing side vmax data from original with log-transformed

#histograms
plotNormalHistogram(lab.data$side_vmax)  #appears pretty symmetrical 
plotNormalHistogram(log_side_vmax)  #skew left

#Shapiro-Wilks test for normality
shapiro.test(lab.data$side_vmax)  #normal -- not transformed
shapiro.test(log_side_vmax)  #not normal -- log transformed
```

```{r}
#Log transform top max velocity vs. bipedalism in top

log_top_vmax <- log(lab.data$top_vmax)
log.top.vmax.biped <- lm(log_top_vmax ~ bipedal_top, data = lab.data)
res.log.top.vmax.biped <- resid(log.top.vmax.biped)
plot(fitted(log.top.vmax.biped), res.log.top.vmax.biped)  

qqnorm(res.log.top.vmax.biped)
qqline(res.log.top.vmax.biped,
       col = 'red')
plot(density(res.log.top.vmax.biped))  #QQ plot looks pretty close to normal

plot(log.top.vmax.biped)

plot(lm(top_vmax ~ bipedal_top, data = lab.data))  #not transformed  #QQ plot is skewed left
```

```{r}
#Comparing top vmax data from original with log-transformed

#histograms
plotNormalHistogram(lab.data$top_vmax)  #appears pretty symmetrical 
plotNormalHistogram(log_top_vmax)  #skew left

#Shapiro-Wilks test for normality
shapiro.test(lab.data$top_vmax)  #normal -- no transformation
shapiro.test(log_top_vmax)  #not normal  -- log transformed
```



# Linear Models with Interaction Effects

```{r}
#Velocity

anova(lm(top_vmax ~ sex*bipedal_top*substrate_type*ID, data=lab.data))
#sex, bipedal_top & substrate type are all significant by themselves

anova(lm(side_vmax ~ sex*bipedal_side*substrate_type*ID, data = lab.data))
#sex and bipedalism were very significant by themselves
#ID was also significant by itself
```

```{r}
#Acceleration

anova(lm(top_amax ~ sex*bipedal_top*substrate_type*ID, data = lab.data))
#nothing is significant

anova(lm(side_amax ~ sex*bipedal_side*substrate_type*ID, data = lab.data))
#nothing is significant
```


# Bipedal Percentage

```{r}
#Bipedal Percentage Plots

#Histogram of bipedal percent without N/A's broken into sex
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=sex, fill=sex)) +
  geom_histogram(col = "white") + 
  labs(title = "Histogram of Bipedal Percent (without N/As) Broken Down by Sex")

#Histogram of bipedal percent without N/A's separated into substrate type
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=substrate_type, fill=substrate_type)) +
  geom_histogram(bins = 20, binwidth = 8) +
  facet_wrap(~substrate_type) +
  labs(title = "Histogram of Bipedal Percent (without N/As) Separated by Substrate Type")

#Histogram of bipedal percent without NA's separated into substrate type and sex
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=substrate_type, fill=substrate_type, alpha=sex)) +
  geom_histogram(bins = 20, binwidth = 8) +
  facet_wrap(~substrate_type) +
  labs(title = "Histogram of Bipedal Percent (without N/As) Separated by Substrate Type and Sex")

#Histogram of bipedal percent without N/A's broken into substrate type
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=substrate_type, fill=substrate_type)) +
  geom_histogram(bins = 20, binwidth = 8) +
  labs(title = "Histogram of Bipedal Percent (without N/As) Broken into Substrate Type")

#Boxplot of bipedal percent without N/A's separated by substrate type
ggplot(data = lab.data_omit, aes(substrate_type, as.numeric(bipedal_percent))) +
  geom_boxplot() + 
  labs(title = "Boxplot of Bipedal Percent (without N/As) by Substrate Type")

#Boxplot of bipedal percent without N/A's separated by sex
ggplot(data = lab.data_omit, aes(sex, as.numeric(bipedal_percent))) +
  geom_boxplot() + 
  labs(title = "Boxplot of Bipedal Percent (without N/As) by Sex")

#Boxplot of bipedal percent without N/A's separated by substrate type and sex
ggplot(data = lab.data_omit, aes(substrate_type, as.numeric(bipedal_percent), fill = sex)) +
  geom_boxplot() +
  labs(title = "Boxplot of Bipedal Percent (without N/As) by Substrate Type and Sex")


#Lizards are running bipedal the most on debris compared to the other substrate types.
#Based on the boxplot, lizards are treating bipedalism on sand/debris as more similar to sand than debris
#Males run bipedally more frequently than females for all substrate types
```


```{r}
#Percent bipedal vs. substrate types and sex linear models
summary(lm(as.numeric(bipedal_percent) ~ substrate_type*sex, data = lab.data_omit))
anova((lm(as.numeric(bipedal_percent) ~ substrate_type*sex, data = lab.data_omit)))

#Neither substrate type nor sex is significantly effecting bipedalism according to the models
```

```{r}
#looked at with Eric during meeting 10/22

#Mixed model bipedal percent and substrate type
lmer2<-lmer(bipedal_percent ~ substrate_type + (1 | ID), data = lab.data_omit)
lmer3<- lmer(sqrt(bipedal_percent) ~ substrate_type + (1 | ID), data = lab.data_omit)
summary(lmer(bipedal_percent ~ substrate_type + (1 | ID), data = lab.data_omit))
Anova(lmer2)

emmeans(lmer2, pairwise ~ substrate_type, adjust = "tukey", data=lab.data)

hist(residuals(lmer2))
hist(residuals(lmer3))

shapiro.test(residuals(lmer2))  #not normal
shapiro.test(residuals(lmer3))  #need sqrt transform - fixed normality issue   #normal

#sand and sand/debris have significant p-values
```

```{r}
lmer.biped.sub <- lmer(sqrt(bipedal_percent) ~ substrate_type + (1|ID), data = lab.data_omit)
anova(lmer.biped.sub)
plotNormalHistogram(residuals(lmer.biped.sub))   #appears normal
lmer.biped.sub.tukey <- emmeans(lmer.biped.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)   
lmer.biped.sub.tukey   #significant differences between D-S but not for D-SD and S-SD
ggplot(data = lab.data_omit, aes(x= substrate_type, y=bipedal_percent)) +
  geom_boxplot() +
  labs(title = "Bipedal Percent by Substrate Type") 
plot(lmer.biped.sub.tukey)
summary(lmer.biped.sub)
performance::r2(lmer.biped.sub)  #low R2s

#can't figure out how to do a Tukey test for lme function so had to use lmer instead
```


```{r}
#Mixed model bipedal percent and sex
lmer(bipedal_percent ~ sex + (1 | ID), data = lab.data_omit)
summary(lmer(bipedal_percent ~ sex + (1 | ID), data = lab.data_omit))
```

```{r}
#Mixed model bipedal percent and substrate type + sex
lmer1<-lmer(bipedal_percent ~ sex*substrate_type + (1 | ID), data = lab.data_omit)
summary(lmer(bipedal_percent ~ sex*substrate_type + (1 | ID), data = lab.data_omit))

#no interaction effects are significant
```

> Levene's test

## Ho: the groups we're comparing all have equal population variances. If this is true, we'll probably find slightly different variances in our samples from these populations. If the sample variances have very different variances then it'll suggest that the population variances weren't equal after all and Ho would have to be rejected.
## Ha: the variance among the groups is not equal
## 2 assumptions: independent observations and the test variable is quantitative
## if p-value is less than significance level (0.05), we can reject Ho and conclude that the variance among the groups is NOT equal
## we want them to not be significant


```{r}
#Levene test - ID
leveneTest(side_amax ~ ID, data = lab_data)   #not significant
leveneTest(top_amax ~ ID, data = lab_data)   #not significant

leveneTest(side_vmax ~ ID, data = lab_data)   #not significant
leveneTest(top_vmax ~ ID, data = lab_data)   #not significant
```

```{r}
#Levene test - sex
leveneTest(side_amax ~ sex, data = lab_data)   #not significant
leveneTest(top_amax ~ sex, data = lab_data)   #not significant

leveneTest(side_vmax ~ sex, data = lab_data)   #not significant
leveneTest(top_vmax ~ sex, data = lab_data)   #not significant
```

```{r}
#Levene test - bipedalism
leveneTest(bipedal_percent ~ substrate_type, data = lab_data)  #not significant so can't reject Ho; variance among groups may be equal
leveneTest(bipedal_side ~ substrate_type, data = lab_data)   #not significant
leveneTest(bipedal_top ~ substrate_type, data = lab_data)   #not significant
```




> Checking assumptions: normality of residuals
## all residuals should be log transformed

```{r}
#Log transforming all variables 
##included log10 and +1 because it forces 0's to be 0's and not something else

log_side_amax <- log10(lab.data$side_amax +1)
log_top_amax <- log10(lab.data$top_amax +1)
log_side_vmax <- log10(lab.data$side_vmax +1)
log_top_vmax <- log10(lab.data$top_vmax +1)
log_side_posmax <- log10(lab.data$side_posmax +1)
log_top_posmax <- log10(lab.data$top_posmax +1)
log_side_tmax <- log10(lab.data$side_tmax +1)
log_top_tmax <- log10(lab.data$top_tmax +1)
log_side_pmax <- log10(lab.data$side_pmax +1)
log_top_pmax <- log10(lab.data$top_pmax +1)

log_bipedal_side <- log10(lab.data$bipedal_side +1)
log_bipedal_top <- log10(lab.data$bipedal_top +1)
log_bipedal_percent <- log10(lab.data$bipedal_percent +1)
```


#Writing linear models and Residuals

```{r}
#log.side.amax.biped
log.side.amax.biped <- lm(log_side_amax ~ log_bipedal_side, data = lab.data)
res.log.side.amax.biped <- resid(log.side.amax.biped)
plot(fitted(log.side.amax.biped), res.log.side.amax.biped)

qqnorm(res.log.side.amax.biped)
qqline(res.log.side.amax.biped,
       col = 'red')
shapiro.test(res.log.side.amax.biped)  #normal
plotNormalHistogram(res.log.side.amax.biped)

#log transforming bipedal_side did not appear to change ANYTHING, so I'm just going to run all other runs using log_bipedal

#lmer model
lmer.log.side.amax.biped <- lmer(log_side_amax ~ log_bipedal_side + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.side.amax.biped)
```


```{r} 
#log.top.amax.biped
log.top.amax.biped <- lm(log_top_amax ~ log_bipedal_top, data = lab.data)
res.log.top.amax.biped <- resid(log.top.amax.biped)

plot(fitted(log.top.amax.biped), res.log.top.amax.biped)
qqnorm(res.log.top.amax.biped)
qqline(res.log.top.amax.biped,
       col = 'red')
shapiro.test(res.log.top.amax.biped)  #normal
plotNormalHistogram(res.log.top.amax.biped)

#lmer model
lmer.log.top.amax.biped <- lmer(log_top_amax ~ log_bipedal_top + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.top.amax.biped)
```

```{r}
#log.side.vmax.biped
log.side.vmax.biped <- lm(log_side_vmax ~ bipedal_side, data = lab.data)
res.log.side.vmax.biped <- resid(log.side.vmax.biped)

plot(fitted(log.side.vmax.biped), res.log.side.vmax.biped)
qqnorm(res.log.side.vmax.biped)
qqline(res.log.side.vmax.biped,
       col = 'red')
shapiro.test(res.log.side.vmax.biped)  #normal
plotNormalHistogram(res.log.side.vmax.biped)

#lmer model
lmer.log.side.vmax.biped <- lmer(log_side_vmax ~ bipedal_side + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.side.vmax.biped)
```

```{r}
#log.top.vmax.biped
log.top.vmax.biped <- lm(log_top_vmax ~ bipedal_top, data = lab.data)
res.log.top.vmax.biped <- resid(log.top.vmax.biped)

plot(fitted(log.top.vmax.biped), res.log.top.vmax.biped)
qqnorm(res.log.top.vmax.biped)
qqline(res.log.top.vmax.biped,
       col = 'red')
shapiro.test(res.log.top.vmax.biped)  #normal
plotNormalHistogram(res.log.top.vmax.biped)

#lmer model
lmer.log.top.vmax.biped <- lmer(log_top_vmax ~ bipedal_top + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.top.vmax.biped)
```

```{r}
#log.side.posmax.biped
log.side.posmax.biped <- lm(log_side_posmax ~ bipedal_side, data = lab.data)
res.log.side.posmax.biped <- resid(log.side.posmax.biped)

plot(fitted(log.side.posmax.biped), res.log.side.posmax.biped)
qqnorm(res.log.side.posmax.biped)
qqline(res.log.side.posmax.biped,
       col = 'red')
shapiro.test(res.log.side.posmax.biped)  #normal
plotNormalHistogram(res.log.side.posmax.biped)

#lmer model
lmer.log.side.posmax.biped <- lmer(log_side_posmax ~ bipedal_side + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.side.posmax.biped)
```

```{r}
#log.top.posmax.biped
log.top.posmax.biped <- lm(log_top_posmax ~ bipedal_top, data = lab.data)
res.log.top.posmax.biped <- resid(log.top.posmax.biped)

plot(fitted(log.top.posmax.biped), res.log.top.posmax.biped)
qqnorm(res.log.top.posmax.biped)
qqline(res.log.top.posmax.biped,
       col = 'red')
shapiro.test(res.log.top.posmax.biped)  #not normal - skewed right   #really weird data
plotNormalHistogram(res.log.top.posmax.biped)

#lmer model
lmer.log.top.posmax.biped <- lmer(log_top_posmax ~ bipedal_top + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.top.posmax.biped)
```

```{r}
#log.side.tmax.biped
log.side.tmax.biped <- lm(log_side_tmax ~ bipedal_side, data = lab.data)
res.log.side.tmax.biped <- resid(log.side.tmax.biped)

plot(fitted(log.side.tmax.biped), res.log.side.tmax.biped)
qqnorm(res.log.side.tmax.biped)
qqline(res.log.side.tmax.biped,
       col = 'red')
shapiro.test(res.log.side.tmax.biped)  #not normal - skewed right
plotNormalHistogram(res.log.side.tmax.biped)

#lmer model
lmer.log.side.tmax.biped <- lmer(log_side_tmax ~ bipedal_side + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.side.tmax.biped)
```

```{r}
#log.top.tmax.biped
log.top.tmax.biped <- lm(log_top_tmax ~ bipedal_top, data = lab.data)
res.log.top.tmax.biped <- resid(log.top.tmax.biped)

plot(fitted(log.top.tmax.biped), res.log.top.tmax.biped)
qqnorm(res.log.top.tmax.biped)
qqline(res.log.top.tmax.biped,
       col = 'red')
shapiro.test(res.log.top.tmax.biped)  #not normal - skewed right
plotNormalHistogram(res.log.top.tmax.biped)

#lmer model
lmer.log.top.tmax.biped <- lmer(log_top_tmax ~ bipedal_top + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.top.tmax.biped)
```

```{r}
#log.side.pmax.biped
log.side.pmax.biped <- lm(log_side_pmax ~ bipedal_side, data = lab.data)
res.log.side.pmax.biped <- resid(log.side.pmax.biped)

plot(fitted(log.side.pmax.biped), res.log.side.pmax.biped)
qqnorm(res.log.side.pmax.biped)
qqline(res.log.side.pmax.biped,
       col = 'red')
shapiro.test(res.log.side.pmax.biped)  #normal 
plotNormalHistogram(res.log.side.pmax.biped)

#lmer model
lmer.log.side.pmax.biped <- lmer(log_side_pmax ~ bipedal_side + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.side.pmax.biped)
```

```{r}
#log.top.pmax.biped
log.top.pmax.biped <- lm(log_top_pmax ~ bipedal_top, data = lab.data)
res.log.top.pmax.biped <- resid(log.top.pmax.biped)

plot(fitted(log.top.pmax.biped), res.log.top.pmax.biped)
qqnorm(res.log.top.pmax.biped)
qqline(res.log.top.pmax.biped,
       col = 'red')
shapiro.test(res.log.top.pmax.biped)  #normal
plotNormalHistogram(res.log.top.pmax.biped)

#lmer model
lmer.log.top.pmax.biped <- lmer(log_top_pmax ~ bipedal_top + substrate_type + sex + (1 | ID), data = lab.data)
anova(lmer.log.top.pmax.biped)
```



> Glmer and lmer

## lmer is used to fit linear mixed-effect models, so it assumes that the residual error has a Gaussian distribution. If your dependent variable A is a binary outcome (e.g. a yes/no response), then the error distribution is binomial and not Gaussian. In this case you have to use glmer, which allow to fit a generalized linear mixed-effects model: these models include a link function that allows to predict response variables with non-Gaussian distributions.
## glmer -> use when dependent variable (X) is a binary outcome (e.g. yes/no)
### 1 refers to an intercept; means 'add a random intercept for each ID level'


#Lmer models with v/a/biped/p/t vs. substrate type -- Question 2

#larger F-values represent greater dispersion of data

```{r}
#Velocity - Side
lmer.log.side.vmax.sub <- lmer(log_side_vmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.side.vmax.sub)
summary(lmer.log.side.vmax.sub)
shapiro.test(residuals(lmer.log.side.vmax.sub))  #normal
lmer.log.side.vmax.sub.tukey <- emmeans(lmer.log.side.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)   
lmer.log.side.vmax.sub.tukey   
ggplot(data = lab.data, aes(x= substrate_type, y=log_side_vmax)) +
  geom_boxplot() +
  labs(title = "Side Velocity by Substrate Type") 
summary(lmer.log.side.vmax.sub)
performance::r2(lmer.log.side.vmax.sub)  #low R2s
```

```{r}
#Velocity - Top
lmer.log.top.vmax.sub <- lmer(log_top_vmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.top.vmax.sub)  
shapiro.test(residuals(lmer.log.top.vmax.sub))  #NOT normal
lmer.log.top.vmax.sub.tukey <- emmeans(lmer.log.top.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)   
lmer.log.top.vmax.sub.tukey   
ggplot(data = lab.data, aes(x= substrate_type, y=log_top_vmax)) +
  geom_boxplot() +
  labs(title = "top Velocity by Substrate Type") 
summary(lmer.log.top.vmax.sub)
performance::r2(lmer.log.top.vmax.sub)  #low R2s
#DATA NOT NORMAL - TRANSFORM
```

```{r}
#Acceleration
lmer.log.side.amax.sub <- lmer(log_side_amax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.side.amax.sub)  
anova(lmer.log.side.amax.sub)  
shapiro.test(residuals(lmer.log.side.amax.sub))   #normal
lmer.log.side.amax.sub.tukey <- emmeans(lmer.log.side.amax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)   
lmer.log.side.amax.sub.tukey   
ggplot(data = lab.data, aes(x= substrate_type, y=log_side_amax)) +
  geom_boxplot() +
  labs(title = "Side Acceleration by Substrate Type") 
summary(lmer.log.side.amax.sub)
performance::r2(lmer.log.side.amax.sub)  #low R2s

lmer.log.top.amax.sub <- lmer(log_top_amax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.top.amax.sub)  
```  

```{r}
#Bipedalism
lmer.log.side.bipedal.sub <- lmer(log_bipedal_side ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.side.bipedal.sub)  

lmer.log.top.bipedal.sub <- lmer(log_bipedal_top ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.top.bipedal.sub)  
```

```{r}
#Power
lmer.log.side.pmax.sub <- lmer(log_side_pmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.side.pmax.sub)   

lmer.log.top.pmax.sub <- lmer(log_top_pmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.top.pmax.sub)   
```

```{r}
#Time
lmer.log.side.tmax.sub <- lmer(log_side_tmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.side.tmax.sub) 

lmer.log.top.tmax.sub <- lmer(log_top_pmax ~ substrate_type + (1 | ID), data = lab.data)
anova(lmer.log.top.tmax.sub)  
```


```{r}
#Velocity - sex
lmer.log.side.vmax.sex <- lmer(log_side_vmax ~ sex + (1 | ID), data = lab.data)
anova(lmer.log.side.vmax.sex)  

lmer.log.top.vmax.sex <- lmer(log_top_vmax ~ sex + (1 | ID), data = lab.data)
anova(lmer.log.top.vmax.sex)  
```




> Tukey Test

## don't need to do with sex because it's only 2 groups and because sex doesn't play a big role in overall analysis

```{r}
#Substrate

tukey.lmer.log.side.amax.sub <- emmeans(lmer.log.side.amax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)
tukey.lmer.log.side.amax.sub
plot(tukey.lmer.log.side.amax.sub)
ggplot(data = lab.data, aes(y=side_amax, x=substrate_type)) +
  geom_boxplot()
#p-value is significant for D-S but not for D-SD and S-SD

tukey.lmer.log.top.amax.sub <- emmeans(lmer.log.top.amax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab.data)
tukey.lmer.log.top.amax.sub
plot(tukey.lmer.log.top.amax.sub)
ggplot(data = lab.data, aes(y=top_amax, x=substrate_type)) +
  geom_boxplot()
#p-value significant for D-S and D-S but not for S-SD

tukey.lmer.log.side.vmax.sub <- emmeans(lmer.log.side.vmax.sub, pairwise ~ substrate_type, adjust = "tukey", data=lab.data)
tukey.lmer.log.side.vmax.sub
plot(tukey.lmer.log.side.vmax.sub)
ggplot(data = lab.data, aes(y=side_vmax, x=substrate_type)) +
  geom_boxplot()
#p-value significant between D-S but not between D-SD and S-SD

tukey.lmer.log.top.vmax.sub <- emmeans(lmer.log.top.vmax.sub, pairwise ~ substrate_type, adjust = "tukey", data=lab.data)
tukey.lmer.log.top.vmax.sub
plot(tukey.lmer.log.top.vmax.sub)
ggplot(data = lab.data, aes(y=top_vmax, x=substrate_type)) +
  geom_boxplot()
#p-value significant between D-S and D-SD but not between S-SD
```



> Bipedalism and Velocity/Acceleration

```{r}
#Bipedalism's effect on side velocity
biped.side.vmax <- lme(log10(bipedal_percent+1) ~ log10(side_vmax+1), random = ~1|ID, data = lab.data_omit)
anova(biped.side.vmax)   #p-value < 0.0001   #significant
hist(residuals(biped.side.vmax))
shapiro.test(residuals(biped.side.vmax))  #normal
summary(biped.side.vmax)
performance::r2(biped.side.vmax)   #low R2s

#velocity does affect bipedalism in side videos 
```

```{r}
vmax.biped.side <- lme(log10(side_vmax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data=lab.data_omit)
anova(vmax.biped.side)   #p-value < 0.0001   #significant
hist(residuals(vmax.biped.side))
shapiro.test(residuals(vmax.biped.side))   #normal
summary(vmax.biped.side)
performance::r2(vmax.biped.side)   #low R2s

#bipedalism does affect velocity in side videos
```

```{r}
#Bipedalism's effect on top velocity
biped.top.vmax <- lme(log10(bipedal_percent+1) ~ log10(top_vmax+1), random = ~1|ID, data = lab.data_omit)
anova(biped.top.vmax)   #p-value = 0.0165   #significant
hist(residuals(biped.top.vmax))
shapiro.test(residuals(biped.top.vmax))   #normal
summary(biped.top.vmax)
performance::r2(biped.top.vmax)   #low R2s

#velocity does affect bipedalism in top videos
```

```{r}
vmax.biped.top <- lme(log10(top_vmax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data=lab.data_omit)
anova(vmax.biped.top)   #p-value = 0.0153   #significant
hist(residuals(vmax.biped.top))
shapiro.test(residuals(vmax.biped.top))   #normal
summary(vmax.biped.top)
performance::r2(vmax.biped.top)   #low R2s

#bipedalism does affect velocity in top videos
```


```{r}
#Bipedalism's effect on side acceleration
biped.side.amax <- lme(log10(bipedal_percent+1) ~ log10(side_amax+1), random = ~1|ID, data = lab.data_omit)
anova(biped.side.amax)   #p-value = 0.9311   #not significant
hist(residuals(biped.side.amax))
shapiro.test(residuals(biped.side.amax))  #normal
summary(biped.side.amax)
performance::r2(biped.side.amax)   #low R2s

#acceleration does not affect bipedalism in side videos 
```

```{r}
amax.biped.side <- lme(log10(side_amax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data=lab.data_omit)
anova(amax.biped.side)   #p-value = 0.6629   #not significant
hist(residuals(amax.biped.side))
shapiro.test(residuals(amax.biped.side))   #normal
summary(amax.biped.side)
performance::r2(amax.biped.side)   #low R2s

#bipedalism does not affect acceleration in side videos
```


```{r}
#Bipedalism's effect on top acceleration
biped.top.amax <- lme(log10(bipedal_percent+1) ~ log10(top_amax+1), random = ~1|ID, data = lab.data_omit)
anova(biped.top.amax)   #p-value = 0.0081   #significant
hist(residuals(biped.top.amax))
shapiro.test(residuals(biped.top.amax))   #normal
summary(biped.top.amax)
performance::r2(biped.top.amax)   #low R2s

#acceleration does affect bipedalism in top videos, but lizard's aren't starting from a standstill so this may be inaccurate
```



> Pauses

```{r}
side.amax.pause <- lme(log_side_amax ~ pauses_side == "0", random = ~1|ID, data = lab.data)
anova(side.amax.pause)   #p-value = 0.2037  #not signficant
hist(residuals(side.amax.pause))
shapiro.test(residuals(side.amax.pause))   #normal
summary(side.amax.pause)
performance::r2(side.amax.pause)   #low R2s

#pauses do not affect acceleration in side videos
```

```{r}
side.amax.pause <- lme(log_side_amax ~ pauses_side, random = ~1|ID, data = lab.data)
anova(side.amax.pause)   #p-value = 0.2341  #not signficant
hist(residuals(side.amax.pause))
shapiro.test(residuals(side.amax.pause))   #normal
summary(side.amax.pause)
performance::r2(side.amax.pause)   #low R2s
```

```{r}
top.amax.pause <- lme(log_top_amax ~ pauses_side)
```

```{r}
lab.data_pause <- lab.data[!is.na(lab.data$pauses_side), ]
```

```{r}
lab.data_side_pause_0 <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.23.20_removed_non-standstill_starts+NAs+negatives_side_pause_0.csv")

lab.data_side_pause_1 <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.15.20_removed_non-standstill_starts+NAs+negatives_side_pause_1+.csv")
```

```{r}
#Pauses effect on side acceleration - 0 pauses
lmer.side.amax.pause0 <- lmer(log10(side_amax+1) ~ pauses_side + (1|ID), data = lab.data_side_pause_0)
summary(lmer.side.amax.pause0)
anova(lmer.side.amax.pause0)   
tukey.lmer.side.amax.pause0 <- emmeans(lmer.side.amax.pause0, pairwise ~ pauses_side, adjust="tukey", data=lab.data_side_pause_0)
tukey.lmer.side.amax.pause0

#not sure what this is saying
```

```{r}
#Pauses effect on side acceleration - 1+ pauses
lmer.side.amax.pause1 <- lmer(log10(side_amax+1) ~ pauses_side + (1|ID), data = lab.data_side_pause_1)
summary(lmer.side.amax.pause1)
anova(lmer.side.amax.pause1)   #not working for some reason
tukey.lmer.side.amax.pause1 <- emmeans(lmer.side.amax.pause0, pairwise ~ pauses_side, adjust="tukey", data=lab.data_side_pause_0)
tukey.lmer.side.amax.pause1

#lme() wouldn't work for some reason

#not sure what this is saying
```

```{r}
is.numeric(lab.data_side_pause_0$pauses_side)
```


> Sex

```{r}
side.amax.sex <- lmer(log_side_amax ~ log_bipedal_side + substrate_type + sex + (1|ID), data = lab.data)
anova(side.amax.sex)
summary(side.amax.sex)

side.amax.sex_null <- lmer(log_side_amax ~ log_bipedal_side + substrate_type + (1|ID), data = lab.data)
anova(side.amax.sex_null)
summary(side.amax.sex_null)
```


> Question 1

> Work from meeting with Eric

```{r}
#Ground Clutter Crossed vs. Speed
speed_ground_cover <- lmer(speed ~ ground_clutter_crossed + (1 | ï..ID), data = McElroy_Habitat_Data2)
anova(speed_ground_cover)
summary(speed_ground_cover)

speed_ground_cover_null <- lmer(speed ~ (1 | ï..ID), data = McElroy_Habitat_Data2)

plot(McElroy_Habitat_Data2$ground_clutter_crossed, McElroy_Habitat_Data2$speed)

ggplot(McElroy_Habitat_Data2, aes(ground_clutter_crossed, speed)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(title = "Ground Clutter Crossed vs Speed in Habitat Data")

#There is a slight upward trend in speed as number of ground clutter crossed increases. This suggests that Racerunners run slightly faster when there are more obstacles in their path. 
```
  

```{r}
#ensuring ground_clutter_crossed is still numeric (it wasn't before, but we changed it, hence the "2" at the end of the dataset name)
is.numeric(McElroy_Habitat_Data2$ground_clutter_crossed)
```

```{r}
#Likelihood ratio test to compare the fit of 2 models
speed_ground_cover_null <- lmer(speed ~ (1 | ï..ID), data = McElroy_Habitat_Data2)
lrtest(speed_ground_cover, speed_ground_cover_null)  #p-value: 0.6112
lrtest(speed_ground_cover_null, speed_ground_cover)   #p-value: 0.6112

#creating a null function allows you to see if adding in a variable does a lot to change the variation in the analysis
#changing the order of the lrtest doesn't change the outcome of the likelihood test
#Ho: the smaller model is the "best" model. It's rejected when the p-value is large (like it is here), which means that the larger model is a significant improvement over the smaller one.   https://www.statisticshowto.com/likelihood-ratio-tests/
  #This means that speed ground clutter crossed does impact speed
```

```{r}
performance::r2(speed_ground_cover)
performance::r2(speed_ground_cover_null)

#conditional and marginal R2s are both higher for regular model (non-null)
```



```{r}
anova(speed_ground_cover)
summary(speed_ground_cover)

lm(speed ~ ground_clutter_crossed, data = McElroy_Habitat_Data2)
anova(lm(speed ~ ground_clutter_crossed, data = McElroy_Habitat_Data2))
anova(lm(log10(speed) ~ log10(ground_clutter_crossed +1) , data = McElroy_Habitat_Data2))
```

```{r}
#Ground Clutter Crossed vs. Speed Lmer Models

#Regular Model
speed.clutter <- lme(speed ~ ground_clutter_crossed, random= ~1|ï..ID, data = McElroy_Habitat_Data2, na.action=na.omit)
anova(speed.clutter)   #p-value = 0.0308  #significant
hist(residuals(speed.clutter))
shapiro.test(residuals(speed.clutter))  #not normal
summary(speed.clutter)
performance::r2(speed.clutter)   #low R2s

#Log-transformed Model
log.speed.clutter <- lme(log10(speed) ~ log10(ground_clutter_crossed+1), random= ~1|ï..ID, data = McElroy_Habitat_Data2, na.action=na.omit)
anova(log.speed.clutter)   #p-value = 0.0412  #significant
hist(residuals(log.speed.clutter))
shapiro.test(residuals(log.speed.clutter))  #normal p=0.2585
performance::r2(log.speed.clutter)  #low R2s

plot(log10(McElroy_Habitat_Data2$ground_clutter_crossed +1), log10(McElroy_Habitat_Data2$speed))
ggplot(McElroy_Habitat_Data2, aes(log10(ground_clutter_crossed+1), log10(speed)) )+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(title = "Log Ground Clutter Crossed vs Log Speed in Habitat Data")

#have to use log-transformed model because non-transformed is not normal
```

# R2 determines how much a variable's behavior can explain the behavior of another variable. A measure 0f 70% or more means that the behavior of the dependent variable is highly explained by the behavior of the independent variable being studied.
  # marginal R2 describes the proportion of variance explained by the fixed factor(s) alone.
  # conditoinal R2 describes the proportion of variance explained by both the fixed and random factors.



> post-meeting

```{r}
lsmeans(random, pairwise ~ ground_clutter_crossed, adjust = "tukey", data=McElroy_Habitat_Data2)
```

```{r}
#Cover vs distance plot of transect data
ggplot(data = field_transects_totals, aes(x=cover_space_cm, y=distance_cm, color = substrate)) +
  geom_point() +
  labs(title = "Transect Data: Cover (cm) vs. Distance (cm)")
```

```{r}
#Distance of Movement vs. Speed
speed_distance_move <- lmer(speed ~ distance_movement + (1 | ï..ID), data = McElroy_Habitat_Data2)
anova(speed_distance_move)
summary(speed_distance_move)

speed_distance_move_null <- lmer(speed ~ (1 | ï..ID), data = McElroy_Habitat_Data2)

ggplot(McElroy_Habitat_Data2, aes(distance_movement, speed)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(title = "Distance of Movement vs Speed in Habitat Data")

#There is a slight upward trend in speed as the distance of each movement increases. This suggests that Racerunners run slightly faster when they run longer distances. 
```


> Bipedalism on difference substrates

```{r}
#Bipedalism percentage per substrate and sex Histogram
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(fill="dark green", bins = 20, binwidth = 10) +
  facet_wrap(~substrate_type + sex) +
  facet_grid(sex ~ substrate_type) +
  labs(title = "Histogram of Bipedalism Percentage per Substrate")

#mean, median & range of bipedal percentage separated into substrate type
summaryBy(bipedal_percent ~ substrate_type + sex, data = lab.data_omit,
          FUN = list(mean, median, min, max))

#males are bipedal more often on every substrate than females

##for final manuscript, change plot titles to actual names instead of letters
### https://www.zevross.com/blog/2019/04/02/easy-multi-panel-plots-in-r-using-facet_wrap-and-facet_grid-from-ggplot2/ 
```

```{r}
#Histogram of bipedal percent without NA's separated into substrate type and sex
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=substrate_type, fill=substrate_type, alpha=sex)) +
  geom_histogram(bins = 20, binwidth = 8) +
  facet_wrap(~substrate_type) +
  labs(title = "Histogram of Bipedal Percent (without N/As) Separated by Substrate Type and Sex")

#Boxplot of bipedal percent without N/A's separated by substrate type and sex
ggplot(data = lab.data_omit, aes(substrate_type, as.numeric(bipedal_percent), fill = sex)) +
  geom_boxplot() +
  labs(title = "Boxplot of Bipedal Percent (without N/As) by Substrate Type and Sex")

#Histogram of bipedal percent without N/A's broken into substrate type
ggplot(data = lab.data_omit, aes(as.numeric(bipedal_percent), col=substrate_type, fill=substrate_type)) +
  geom_histogram(col = "white") + 
  labs(title = "Histogram of Bipedal Percent (without N/As) Broken Down by Substrate Type")
```


# Trying to compare heavy vs. light obstacles crossed in McElroy habitat data. However, there probably is not enough heavy data to do a good analysis on. Therefore comparing this to the light data is probably pointless.
# 0-9 obstsacles = light
# 10-20 obstacles = heavy
```{r}
#Ground clutter crossed (heavy) vs. speed
speed.clutter.heavy <- lme(log10(speed+1) ~ log10(ground_clutter_crossed+1), random= ~1|ID, data = McElroy_Habitat_Data2_heavy, na.action=na.omit)
anova(speed.clutter.heavy)  #p-value = 02644  #not significant
hist(residuals(speed.clutter))
shapiro.test(residuals(speed.clutter.heavy))  #normal
summary(speed.clutter.heavy)
performance::r2(speed.clutter.heavy)   #low R2s

#Ground clutter crossed (light) vs. speed
speed.clutter.light <- lme(log10(speed+1) ~ log(ground_clutter_crossed+1), random= ~1|ID, data = McElroy_Habitat_Data2_light, na.action=na.omit)
anova(speed.clutter.light)  #p-value = 0.0309  # significant
hist(residuals(speed.clutter))
shapiro.test(residuals(speed.clutter.light))  #normal
summary(speed.clutter.light)
performance::r2(speed.clutter.light)   #low R2s
```




Question 3: Is the pattern observed in question #1 explained by question #2?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners avoid moving on suboptimal parts of habitat.


> McElroy fieldspeed data

# SAND and DEBRIS were easy to tell,  however, MIXED was usually some open sand with patched of debris 'mixed' in, so it's a much more heterogenous category.   
# I suggest you compute the proportion of movements that were on each substrate type and if there is a relationship between speed and substrate type in the field.  You might think of other comparisons you could make.  You might also try the mixed model, because there data are 'repeated' measurements (i.e. each lizard has 1-4 movements, so there is a clumping of movements within lizard).


```{r}
is.factor(fieldspeed_final$ID)  #changed IDs to letters in fieldspeed_final so that they were factors b/c couldn't figure out how to change in r
is.factor(fieldspeed_final$ID)
is.factor(fieldspeed_final$Substrate.Type)
is.numeric(fieldspeed_final$Segment.)
is.numeric(fieldspeed_final$NumberClutter)
```

```{r}
#Speed vs. Substrate Type 
mcelroy_speed_sub_lme <- lme(Speed ~ Substrate.Type, random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_speed_sub_lme)  #p-value=0.3845  #not significant
mcelroy_speed_sub_lme_tukey <- emmeans(mcelroy_speed_sub_lme, pairwise ~ Substrate.Type, adjust = "tukey", data = fieldspeed_final)
mcelroy_speed_sub_lme_tukey  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme))
shapiro.test(residuals(mcelroy_speed_sub_lme))  #normal

fieldspeed_final3 <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final3.csv")  
  #removed 2 blank substrate rows b/c couldn't figure out how to plot boxplot without them

ggplot(data = fieldspeed_final3, aes(x = Substrate.Type, y = Speed)) +
  geom_boxplot() +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5)) 


#Substrate type doesn't appear to affect speed at all

anova(lme(Speed ~ Substrate.Type + Sex, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
#Sex doesn't affect model either
```


```{r}
ggplot(data = fieldspeed_final, aes(Segment.), alpha = Substrate.Type.) +
  geom_histogram() +
  facet_wrap(~Substrate.Type) +
  labs(x = "Movement Segment") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```

```{r}
table(fieldspeed_final$Segment.)                    #total: 46
table(fieldspeed_final$Substrate.Type == "DEBRIS")  #2  (4.3%)
table(fieldspeed_final$Substrate.Type == "MIXED")   #12 (26.1%)
table(fieldspeed_final$Substrate.Type == "SAND")    #30 (65.2%)
table(fieldspeed_final$Substrate.Type == "")        #2  (4.3%)

#most of lizards' movements are happening on sand, then mixed, and only a few happen on debris
```


#Speed vs. Number Clutter 

```{r}
mcelroy_speed_clutter_lme <- lme(Speed ~ NumberClutter, random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_speed_clutter_lme)  #p-value=0.1097  #not significant
mcelroy_speed_clutter_lme_tukey <- emmeans(mcelroy_speed_clutter_lme, pairwise ~ NumberClutter, adjust = "tukey", data = fieldspeed_final, 
                                           na.action = na.omit)
mcelroy_speed_clutter_lme_tukey  #nothing to compare
shapiro.test(residuals(mcelroy_speed_clutter_lme))  #normal
hist(residuals(mcelroy_speed_clutter_lme))
performance::r2(mcelroy_speed_clutter_lme)  #ok  #C=0.280   #M=0.075

#Number of clutter doesn't affect speed

anova(lme(Speed ~ NumberClutter + Sex + Substrate.Type, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
anova(lme(Speed ~ NumberClutter + Substrate.Type, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
anova(lme(Speed ~ NumberClutter + Sex, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
#Neither sex nor substrate type affect speed ~ numberclutter
```

```{r}
#Log transformed Speed vs.log-transformed number clutter
mcelroy_speed_clutter_lme_log <- lme(log10(Speed) ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log)  #p-value=0.0943  #not significant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log))  #not normal
hist(residuals(mcelroy_speed_clutter_lme_log))
performance::r2(mcelroy_speed_clutter_lme_log)  #ok  #C=0.258   #M=0.087
```

```{r}
#Log transformed Speed vs.number clutter
mcelroy_speed_clutter_lme_log2 <- lme(log10(Speed) ~ NumberClutter, random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log2)  #p-value=0.0943  #not significant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log2))  #not normal
hist(residuals(mcelroy_speed_clutter_lme_log2))
performance::r2(mcelroy_speed_clutter_lme_log2)  #ok  #C=0.273   #M=0.073
```

```{r}
#Speed vs Log transformed number clutter  -- best model
mcelroy_speed_clutter_lme_log3 <- lme(Speed ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log3)  #p-value=0.0703  #not significant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log3))  #normal
hist(residuals(mcelroy_speed_clutter_lme_log3))
performance::r2(mcelroy_speed_clutter_lme_log3)  #ok  #C=0.290   #M=0.102

ggplot(fieldspeed_final, aes(log10(NumberClutter+1), Speed))+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#slight upward trend: as ground clutter increased, speed also increased slightly
```

```{r}
table(fieldspeed_final$NumberClutter)   #44
table(fieldspeed_final$ID)  #41
table(fieldspeed_final4$ID)  #37
```


#Distance vs. Clutter

```{r}
#Distance vs. Number Clutter 1
mcelroy_dist_clutter_lme <- lme(Distance ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_dist_clutter_lme)  #p-value=0.0233
shapiro.test(residuals(mcelroy_dist_clutter_lme))  #not normal
hist(residuals(mcelroy_dist_clutter_lme))
performance::r2(mcelroy_dist_clutter_lme)  
```

```{r}
#Distance vs. Number Clutter 2
mcelroy_dist_clutter_lme2 <- lme(Distance ~ NumberClutter, random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_dist_clutter_lme2)  #p-value=0.0229
shapiro.test(residuals(mcelroy_dist_clutter_lme2))  #not normal
hist(residuals(mcelroy_dist_clutter_lme2))
performance::r2(mcelroy_dist_clutter_lme2)
```

```{r}
#Distance vs. Number Clutter 3 -- best model
mcelroy_dist_clutter_lme3 <- lme(log10(Distance) ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_dist_clutter_lme3)  #p-value=0.0137  #significant
shapiro.test(residuals(mcelroy_dist_clutter_lme3))  #normal
hist(residuals(mcelroy_dist_clutter_lme3))
performance::r2(mcelroy_dist_clutter_lme3)  #good  #C=0.586  #M=0.154

ggplot(fieldspeed_final, aes(log10(NumberClutter+1), log10(Distance))) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Number of Clutter Crossed", y = "Distance Traveled (m)")
#trying to get dots to color-coordinate with ID, but when I put col=ID after Distance in aes, it messes up the lm line

#not sure if this analysis will be useful; it makes sense that the farther the lizards run, the more clutter they would have to cross
```


#Speed vs. Distance 

```{r}
#Speed vs. Distance
mcelroy_dist_speed_lme <- lme(log10(Speed) ~ log10(Distance), random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_dist_speed_lme)  #p-value=0.0001  #significant
shapiro.test(residuals(mcelroy_dist_speed_lme))   #normal
hist(residuals(mcelroy_dist_speed_lme))
performance::r2(mcelroy_dist_speed_lme)  #good  #C=0.702  #M=0.449

ggplot(fieldspeed_final, aes(log10(Distance), log10(Speed))) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Distance (m)", y = "Speed (m/s)") +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```

```{r}
fieldspeed_final_time_movement <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_time_movement.csv")

#time spent per substrate
ggplot(fieldspeed_final_time_movement, aes(TimePerMovement)) +
  geom_histogram() +
  facet_wrap(~Substrate.Type)

summaryBy(TimePerMovement ~ Substrate.Type, data = fieldspeed_final_time_movement,
          FUN = list(mean, median, min, max))
#spent more time on sand than debris or mixed but time differences are not significant

sub.movement <- lme(log10(TimePerMovement) ~ Substrate.Type, random = ~1|ID, data = fieldspeed_final_time_movement)
anova(sub.movement)  #p-value=0.9167  #not signficant
shapiro.test(residuals(sub.movement))  #normal
hist(residuals(sub.movement))
performance::r2(sub.movement)  #C=0.592  #M=0.003
emmeans(sub.movement, pairwise ~ Substrate.Type, adjust = "tukey", data=fieldspeed_final_time_movement)
  #no differences in substrate type are significant

ggplot(fieldspeed_final_time_movement, aes(x=Substrate.Type, y=TimePerMovement)) +
  geom_boxplot()
```


```{r}
#Speed vs. Substrate Type 
mcelroy_speed_sub_lme <- lme(Speed ~ Substrate.Type, random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_speed_sub_lme)  #p-value=0.3845  #not significant
mcelroy_speed_sub_lme_tukey <- emmeans(mcelroy_speed_sub_lme, pairwise ~ Substrate.Type, adjust = "tukey", data = fieldspeed_final)
mcelroy_speed_sub_lme_tukey  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme))
shapiro.test(residuals(mcelroy_speed_sub_lme))  #normal

anova(lme(Speed ~ Substrate.Type + Sex, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
#Sex doesn't affect model either

ggplot(data = fieldspeed_final, aes(x = Substrate.Type, y = Speed)) +
  geom_boxplot() +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#Substrate type doesn't appear to affect speed at all
```

```{r}
#Speed vs. Substrate Type 
#trying to get blank box on boxplot removed but couldn't figure out how to do in R so had to make new csv file
#comparing results with above

fieldspeed_final_reduced <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_reduced.csv")

mcelroy_speed_sub_lme2 <- lme(Speed ~ Substrate.Type, random = ~1|ID, data = fieldspeed_final_reduced, na.action=na.omit)
anova(mcelroy_speed_sub_lme2)  #p-value=0.3976  #not significant
mcelroy_speed_sub_lme_tukey2 <- emmeans(mcelroy_speed_sub_lme2, pairwise ~ Substrate.Type, adjust = "tukey", data = fieldspeed_final_reduced)
mcelroy_speed_sub_lme_tukey2  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme2))
shapiro.test(residuals(mcelroy_speed_sub_lme2))  #normal

ggplot(data = fieldspeed_final_reduced, aes(x = Substrate.Type, y = Speed)) +
  geom_boxplot() +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```



```{r}
#Velocity vs Substrate Type - Top

lme.log.top.vmax.sub <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.top.vmax.sub)  #p-value=0.0004  #significant
hist(residuals(lme.log.top.vmax.sub))
shapiro.test(residuals(lme.log.top.vmax.sub))  # not normal
summary(lme.log.top.vmax.sub)
performance::r2(lme.log.top.vmax.sub)  #pretty low R2s
lme.log.top.vmax.sub.tukey <- emmeans(lme.log.top.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.top.vmax.sub.tukey  #no significant differences between substrates

#DATA IS NOT NORMAL -- TRANSFORM
#data isn't normal without log10, with log10

#no significant differences between substrates

#LOOK BACK AT!!!!!!!!!!!!!!!!!!!!!!!!!1


lme1 <- lme(top_vmax ~ substrate_type, random = ~1|ID, data = lab_data)  #un-transformed
shapiro.test(residuals(lme1))  #not normal
hist(residuals(lme1))

lme2 <- lme(sqrt(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)  #square root
shapiro.test(residuals(lme2))  #not normal
hist(residuals(lme2))

lme3 <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)  #log
shapiro.test(residuals(lme3))  #not normal
hist(residuals(lme3))

lme4 <- lme(abs(top_vmax+1)^(1/3) ~ substrate_type, random = ~1|ID, data = lab_data)  #cubed root
shapiro.test(residuals(lme4))  #not normal
hist(residuals(lme4))

lme5 <- lme(transformTukey(top_vmax+1, plotit = FALSE) ~ substrate_type, random = ~1|ID, data = lab_data)  #TUkey's ladder of powers
shapiro.test(residuals(lme5))  #not normal
hist(residuals(lme5))
plotNormalHistogram(residuals(lme5))

lme6 <- lm(top_vmax ~ substrate_type, data = lab_data)
shapiro.test(residuals(lme6))  #normal
plotNormalHistogram(residuals(lme6))

hist(lab_data$top_vmax)
shapiro.test(lab_data$top_vmax)
```
