---
title: "Thesis_Stats_reduced"
author: "Kayla Pehl"
date: "2/21/2021"
output:
  word_document: default
  html_document: default
---

#This file contains models and plots from Thesis_Stats_all but only includes code that is being used in actual manuscript. All extra plots and code that are not currently in the manuscript are not in this file.

```{r}
#Loading necessary packages
library(ggplot2)
library(lme4)
library(doBy)
library(car)
library(emmeans)
library(nlme)
library(lmtest)
```

```{r}
#Set working directory
setwd("~/College of Charleston/Thesis/R_Data")

#Importing data

field_transect_condensed <- read.csv("field_transect_condensed.csv")
  #field transect data broken into debris, mixed and sand to match lab data
fieldspeed_substrate_percent <- read.csv("fieldspeed_substrate_percent.csv")
  #field data with substrate percentages
cover <- read.csv("cover.csv")
  #data of cover in the habitat assessment
field_obs_sub <- read.csv("field_obs_sub.csv")
  #field transect data - obstacles - broken into substrate type where the obstacles were found
RR_demo2 <- read.csv("RR_demo2.csv")
  #demographics including peak velocity and acceleration (all and divided by substrate) for each lizard
lab_data2 <- read.csv("lab_data2.csv")
  #includes peak velocity column and biped total column
lab_data2_omit <- lab_data2[!is.na(lab_data2$bipedal_percent), ]
  #includes peak velocity column and biped total column with non-bipedal rows omitted
fieldspeed <-  read.csv("fieldspeed.csv")
  #final fieldspeed data from the field
fieldspeed_jan <- read.csv("fieldspeed_jan.csv")
  #final fieldspeed data without 2 rows that did not have substrate type listed & rows without speed values
fieldspeed_reduced_debris <- read.csv("~/College of Charleston/Thesis/R_Data/fieldspeed_reduced_debris.csv")
  #same as fieldspeed_reduced except 2 debris points were removed for ground clutter analysis b/c debris substrates are made up of obstacles
```

```{r}
#Additional Data - Habitat assessment transect GPS points

##all latitude points are East and all longitude points are North
transect_GPS_coordinates <- read.csv("transect_GPS_coordinates.csv")
```


Question 1: Do "A. sexlineata" move through their habitat randomly or non-randomly?

```{r}
#bar plot of habitat assessment substrate totals condensed
ggplot(field_transect_condensed, aes(x=substrate, y=distance_m)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Substrate", y = "Distance (m)", title = "Habitat Assessment: Amount of Each Substrate") +
  geom_text(aes(x=substrate, y = distance_m, label = percent_type, vjust = 1), size=4, 
            color = "black") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"),
        plot.title = element_text(size = 15))

ggsave("field_transect_condensed.png")
```

```{r}
#bar plot of field data substrate totals
ggplot(fieldspeed_substrate_percent, aes(x=Substrate.Type, y=Distance)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Substrate", y = "Distance Traveled (m)", title = "Field Data: Racerunner Distance Traveled per Substrate") +
  geom_text(aes(x=Substrate.Type, y = Distance, label = PercentSubstrate, vjust = 1), size=4, 
            color = "black") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

ggsave("fieldspeed_substrate_percent.png")
```

```{r}
#bar plot of cover
ggplot(cover, aes(x=substrate, y=distance_m)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Substrate", y = "Distance Cover (m)", title = "Habitat Assessment: Amount of Cover per Substrate") +
  geom_text(aes(x=substrate, y = distance_m, label = percent, vjust = 1), size=4, 
            color = "black") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

ggsave("cover.png")
```

```{r}
#Chi Square test to see if % habitat is related to % field data
env <- matrix(c(1899.5, 1.05, 1307.95, 16.94, 637.45, 34.928), ncol = 2, byrow = TRUE)
colnames(env) <- c("random", "used")
rownames(env) <- c("debris", "mixed", "sand")
env

chisq.test(env)  #p < 2.2e-16  #significant - distribution of proportions between the two groups is different
```


Question 2: How does "available" habitat affect "A. sexlineata" locomotion?

> Testing effect of sex, SVL, and tail length 

>> Lab Data

```{r}
#Velocity 
vel_sex <- lm(log10(peak_v) ~ sex, data = RR_demo2)   
anova(vel_sex)   #p=0.1519

vel_svl <- lm(log10(peak_v) ~ svl, data = RR_demo2)   
anova(vel_svl)   #p=0.5978

vel_tl <- lm(log10(peak_v) ~ tail_length, data = RR_demo2)   
anova(vel_tl)   #p=0.1286

#neither sex, SVL, or tail length affect acceleration
```

```{r}
#Acceleration
acc_sex <- lm(log10(peak_acc) ~ sex, data = RR_demo2)   
anova(acc_sex)   #p=0.1003

acc_svl <- lm(log10(peak_acc) ~ svl, data = RR_demo2)   
anova(acc_svl)   #p=0.8229

acc_tl <- lm(log10(peak_acc) ~ tail_length, data = RR_demo2)   
anova(acc_tl)   #p=0.02722

#tail length affected acceleration but sex and SVL did not 
```

>> Field Data

```{r}
speed_sex <- lm(log10(Speed) ~ Sex, data = fieldspeed_jan, na.action=na.omit)
anova(speed_sex)  #p=0.692

clutter_sex <- lm(log10(NumberClutter+1) ~ Sex, data = fieldspeed, na.action = na.omit)
anova(clutter_sex)  #p=0.6028

#sex doesn't affect speed or clutter in field data
```

> Lab Data

```{r}
#Velocity ~ Substrate 
lme.log.side.vmax.sub <- lme(log10(peak_v) ~ substrate_type*biped_combined, random = ~1|ID, data = lab_data2)
anova(lme.log.side.vmax.sub, type="marginal")  #biped & interaction significant

shapiro.test(residuals(lme.log.side.vmax.sub))  #normal
performance::r2(lme.log.side.vmax.sub)  #C=0.479, M=0.359
lme.log.side.vmax.sub.tukey <- emmeans(lme.log.side.vmax.sub, pairwise ~ substrate_type*biped_combined, adjust="tukey", data=lab_data2)
lme.log.side.vmax.sub.tukey  #some significant differences due to gait

ggplot(lab_data2, aes(y=peak_v, x=substrate_type, fill = biped_combined)) +
  geom_boxplot(outlier.shape = NA) + 
  scale_fill_discrete(labels = c("bipedal", "quadrupedal")) +
  labs(x = "Substrate", y = "Peak Velocity (m/s)", title = "Lab Data: Peak Velocity vs. Substrate") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"),
        legend.title = element_blank())

ggsave("lab_data2.png")
```

```{r}
#Acceleration ~ Substrate
lme.log.side.amax.sub <- lme(log10(side_amax) ~ substrate_type*biped_combined, random = ~1|ID, data = lab_data2)
anova(lme.log.side.amax.sub, type="marginal")  #all insignificant

shapiro.test(residuals(lme.log.side.amax.sub))  #normal
performance::r2(lme.log.side.amax.sub)  #C=0.0.79, M=0.031
lme.log.side.amax.tukey2 <- emmeans(lme.log.side.amax.sub, pairwise ~ substrate_type*biped_combined, adjust="tukey", data=lab_data2)
lme.log.side.amax.tukey2   #no significant differences in any substrate's acceleration based on gait

ggplot(lab_data2, aes(y=side_amax, x=substrate_type, fill = biped_combined)) +
  geom_boxplot(outlier.shape = NA) + 
  scale_fill_discrete(labels = c("bipedal", "quadrupedal")) +
  labs(x = "Substrate", y = bquote('Peak Acceleration' ~ (m/s^2)), title = "Lab Data: Peak Acceleration vs. Substrate") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"),
        legend.title = element_blank())

ggsave("lab_data2.png")
```

```{r}
#Percent Bipedal ~ Substrate
lme.biped.sub <- lme(sqrt(bipedal_percent) ~ substrate_type, random = ~1|ID, data = lab_data2_omit)
anova(lme.biped.sub, type="marginal")  #p=0.0512 - substrate barely insignificant

shapiro.test(residuals(lme.biped.sub))  #normal
performance::r2(lme.biped.sub)  #C=0.417, M=0.050
lme.biped.sub.tukey <- emmeans(lme.biped.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data2_omit)
lme.biped.sub.tukey  #no significant differences in substrates

ggplot(lab_data2_omit, aes(y=bipedal_percent, x=substrate_type, fill = substrate_type)) +
  geom_boxplot(outlier.shape = NA) + 
  scale_fill_manual(values = c("lightskyblue2", "lightblue2", "steelblue")) +
  labs(x = "Substrate", y = "Percent Bipedal", title = "Lab Data: Percent Bipedal vs. Substrate") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

ggsave("lab_data2_omit.png")
```


```{r}
#Bipedalism's effect on peak velocity 
peakv.biped <- lme(log10(peak_v+1) ~ log10(bipedal_percent+1), random = ~1|ID, data = lab_data2_omit)
anova(peakv.biped)  #p-value substrate=0.0655, insignificant   #sex = insignificant
hist(residuals(peakv.biped))
shapiro.test(residuals(peakv.biped))  #normal
summary(peakv.biped)
performance::r2(peakv.biped)  #C=0.419  #M=0.075

ggplot(lab_data2_omit, aes(bipedal_percent, peak_v)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Percent Bipedal", y = "Peak Velocity (m/s)", title = 'Lab Data: Peak Velocity vs. Percent Bipedal') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"),
        axis.text = element_text(face = "bold"))
ggsave("lab_data2_omit.pdf")
ggsave("lab_data2_omit.png")

#bipedalism does not affect peak velocity
```

```{r}
#Bipedalism's effect on side acceleration
side.amax.biped <- lme(log10(side_amax+1) ~ log10(bipedal_percent+1) + sex, random = ~1|ID, data = lab_data2_omit)
anova(side.amax.biped)  #p-value substrate & sex = insignificant
hist(residuals(side.amax.biped))
shapiro.test(residuals(side.amax.biped))  #normal
summary(side.amax.biped)
performance::r2(side.amax.biped)  #C=0.130  #M=0.005

ggplot(lab_data2_omit, aes(bipedal_percent, side_amax)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Percent Bipedal", y = bquote('Peak Acceleration' ~ (m/s^2)), title = 'Lab Data: Peak Acceleration vs. Percent Bipedal') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"),
        axis.text = element_text(face = "bold"))

ggsave("lab_data2_omit.png")
#Bipedalism does not effect acceleration in side videos
```

```{r}
#Looking at bipedal vs. quadrupedal percentages from side and top

table(lab_data2$bipedal_quad_side)
#42.4% bipedal on side runs, 57.6% quadrupedal on side runs

table(lab_data2$bipedal_quad_top)
#55.4% bipedal on top runs, 44.6% quadrupedal on top runs
```

> Field Data

```{r}
#Speed ~ Substrate
mcelroy_speed_sub_lm <- lm(log10(Speed+1) ~ Substrate.Type, data = fieldspeed_jan, na.action=na.omit)
anova(mcelroy_speed_sub_lm)   #p=0.2832

mcelroy_speed_sub_lm.tukey <- emmeans(mcelroy_speed_sub_lm, pairwise ~ Substrate.Type, adjust="tukey", data=fieldspeed_jan)
mcelroy_speed_sub_lm.tukey

shapiro.test(residuals(mcelroy_speed_sub_lm))  #normal

ggplot(fieldspeed_jan, aes(x = reorder(Substrate.Type, Speed, FUN = median), y = Speed, fill = Substrate.Type)) + 
  geom_boxplot() +
  scale_fill_manual(values = c("lightskyblue2", "steelblue", "lightblue2")) +
  labs(x = "Substrate", y = "Speed (m/s)", title = "Field Data: Speed vs. Substrate") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

ggsave("fieldspeed_jan.png")
```

```{r}
#Speed ~ Number Clutter
mcelroy_speed_clutter_lm <- lm(log10(Speed+1) ~ log10(NumberClutter+1), data = fieldspeed_reduced_debris, na.action = na.omit)
anova(mcelroy_speed_clutter_lm)   #p=0.02004, significant

shapiro.test(residuals(mcelroy_speed_clutter_lm))   #normal

ggplot(fieldspeed_reduced_debris, aes(log(NumberClutter+1), log(Speed+1)))+
  geom_point(aes(color = Substrate.Type)) + 
  geom_smooth(method = 'lm') +
  labs(x = "log10(Ground Clutter Crossed)", y = "log10(Speed) (m/s)", title = "Lab Data: Speed vs. Ground Clutter Crossed") +
  scale_color_discrete(name = "Substrate Type", labels = c("Mixed", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"),
        axis.text = element_text(face = "bold"))
        #plot.title = element_text(size = 14, face = "bold"),
        #axis.title.x = element_text(size = 12, face = "bold"),
        #axis.title.y = element_text(size = 12, face = "bold"))

ggsave("fieldspeed_reduced_debris.png")
```



