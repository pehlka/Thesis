---
title: "Thesis_Stats_all"
author: "Kayla Pehl"
date: "10/29/2020"
output: html_document
---

```{r}
#Loading necessary packages
library(ggplot2)
library(lme4)
library(doBy)
library(car)
library(emmeans)
library(nlme)
library(lmtest)
```

```{r}
#Importing data
lab_data <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.26.20_removed_non-standstill_starts+NAs+negatives+3lizards.csv")  
  #lab experiment data without no-standstill starts & 3 incomplete lizards
lab_data_omit <- lab_data[!is.na(lab_data$bipedal_percent), ]
  #lab_data without trials that were run quadrupedally with no bipedalism present
fieldspeed <-  read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_11.18.20.csv")
  #final fieldspeed data; double checked with data sheets & it's correct 11.18.20
  #replacing all fieldspeed_final data and McElroy_habitat_data
fieldspeed_reduced <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_reduced_11.18.20.csv")
  #final fieldspeed data without 2 rows that did not have substrate type listed
field_transect_data_totals <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals.csv") 
  #field transect substrate totals
field_transect_data_totals_condensed <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals_condensed.csv")
  #field transect substrate totals condensed into debris/mixed/vegetation/sand
field_transect_data_totals_heaviness <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_heaviness.csv")
  #field transect susbtrate totals broken into heavy/light/sand
Racerunner_demographics <- read.csv("~/College of Charleston/Thesis/Data/Racerunner_demographics.csv")
  #demographic data of lizards ran in the lab
```



Question 1: Do Racerunners use their habitat randomly or non-randomly?
 Ho: Racerunners use their habitat randomly.
 Ha: Racerunners use their habitat non-randomly.
 
```{r}
#Ground Clutter Crossed vs. Speed

log.speed.clutter <- lme(log10(Speed) ~ log10(NumberClutter+1), random= ~1|ID, data = fieldspeed, na.action=na.omit)
anova(log.speed.clutter)   #p-value = 0.1255  #not significant
hist(residuals(log.speed.clutter))
shapiro.test(residuals(log.speed.clutter))  #normal  
performance::r2(log.speed.clutter)  #C=0.206 #M=0.068 

ggplot(fieldspeed, aes(log10(NumberClutter+1), log10(Speed)) )+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#Slight upward trend: as ground clutter increases, so does speed
``` 

```{r}
#Field Transect Data
field_transect_data_totals  #heavy mixed most common
field_transect_data_totals_condensed  #mixed most common
field_transect_data_totals_heaviness  #heavy derbis/mixed/veg most common
```





Question 2: How does "available" habitat affect Racerunner locomotion?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners run fastest on sand compared to debris and sand/debris.

```{r}
#Velocity vs Substrate Type - Side
lme.log.side.vmax.sub <- lme(log10(side_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.side.vmax.sub)  #p-value=0.0028  #significant
ggplot(lab_data, aes(residuals(lme.log.side.vmax.sub))) + 
  geom_histogram(bins = 11, color = "white") +
  labs(x = "Residuals of lme.log.side.vmax.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.vmax.sub))  #normal (but just barely)
summary(lme.log.side.vmax.sub)
performance::r2(lme.log.side.vmax.sub)  #C=0.395 #M=0.056
lme.log.side.vmax.sub.tukey <- emmeans(lme.log.side.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.side.vmax.sub.tukey  #significant differences between D-S but not D-SD or S-SD

ggplot(lab_data, aes(y=log10(side_vmax+1), x=substrate_type)) +  #fill = substrate_type
  geom_boxplot() + 
  labs(x = "Substrate", y = "Velocity (side camera) (m/s)") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```

```{r}
#creating labels for histograms
sex.labs <- c("Female", "Male")
names(sex.labs) <- c("F", "M")
sub.labs <- c("Debris", "Sand", "Sand/Debris")
names(sub.labs) <- c("D", "S", "SD")
```

```{r}
#Velocity vs Substrate Type - Side
ggplot(data = lab_data, aes(side_vmax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = "Velocity (Side Camera) (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of top max velocity separated into substrate types
summaryBy(side_vmax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Velocity vs Substrate Type - Top

lme.log.top.vmax.sub <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.top.vmax.sub)  #p-value=0.0004  #significant
hist(residuals(lme.log.top.vmax.sub))
shapiro.test(residuals(lme.log.top.vmax.sub))  # not normal
summary(lme.log.top.vmax.sub)
performance::r2(lme.log.top.vmax.sub)  #pretty low R2s
lme.log.top.vmax.sub.tukey <- emmeans(lme.log.top.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.top.vmax.sub.tukey  #no significant differences between substrates

#DATA IS NOT NORMAL -- TRANSFORM
```

```{r}
#Transformations of Velocity vs Substrate Type - Top
#none of the transformations are normal

lme1 <- lme(top_vmax ~ substrate_type, random = ~1|ID, data = lab_data)  #un-transformed
shapiro.test(residuals(lme1))  #not normal
hist(residuals(lme1))

lme2 <- lme(sqrt(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)  #square root
shapiro.test(residuals(lme2))  #not normal
hist(residuals(lme2))

lme3 <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)  #log
shapiro.test(residuals(lme3))  #not normal
hist(residuals(lme3))

lme4 <- lme(abs(top_vmax+1)^(1/3) ~ substrate_type, random = ~1|ID, data = lab_data)  #cubed root
shapiro.test(residuals(lme4))  #not normal
hist(residuals(lme4))

lme5 <- lme(transformTukey(top_vmax+1, plotit = FALSE) ~ substrate_type, random = ~1|ID, data = lab_data)  #TUkey's ladder of powers
shapiro.test(residuals(lme5))  #not normal
hist(residuals(lme5))
plotNormalHistogram(residuals(lme5))

lme6 <- lm(top_vmax ~ substrate_type, data = lab_data)
shapiro.test(residuals(lme6))  #normal but not a mixed-effect model
plotNormalHistogram(residuals(lme6))

hist(lab_data$top_vmax)
shapiro.test(lab_data$top_vmax)
```


```{r}
#Top max velocity per substrate 
ggplot(data = lab_data, aes(top_vmax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = "Velocity (Top Camera) (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of top max velocity separated into substrate types
summaryBy(top_vmax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Acceleration vs Substrate Type - Side
lme.log.side.amax.sub <- lme(log10(side_amax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.side.amax.sub)  #p-value=0.8411  #not significant
ggplot(lab_data, aes(residuals(lme.log.side.amax.sub))) + 
  geom_histogram(bins = 8, color = "white") +
  labs(x = "Residuals of lme.log.side.amax.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.amax.sub))  #normal
summary(lme.log.side.amax.sub)
performance::r2(lme.log.side.amax.sub)   #C=0.047  #M=0.002
lme.log.side.amax.sub.tukey <- emmeans(lme.log.side.amax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.side.amax.sub.tukey  #no significant differences in any substrate's acceleration

ggplot(lab_data, aes(y=log10(side_amax+1), x=substrate_type)) +
  geom_boxplot() + 
  labs(x = "Substrate", y = "Acceleration (side camera) (m^2/s)") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#low R2s make sense because the model shows that susbtrate type doesn't affect acceleration, which means that substrate type should not explain a high percentage of changes in the data

#substrate does not affect acceleration in side videos
```

```{r}
#Acceleration vs Substrate Type - Side
ggplot(data = lab_data, aes(side_amax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = bquote('Acceleration (Side Camera)' ~ (m^2/s))) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of side_amax data separated into substrate types
summaryBy(side_amax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Bipedalism vs Substrate Type
lme.biped.sub <- lme(sqrt(bipedal_percent) ~ substrate_type, random = ~1|ID, data = lab_data_omit)
anova(lme.biped.sub)  #p-value=0.0512  #barely not significant
ggplot(lab_data_omit, aes(residuals(lme.biped.sub))) + 
  geom_histogram(bins = 7, color = "white") +
  labs(x = "Residuals of lme.biped.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.biped.sub))   #normal
summary(lme.biped.sub)
performance::r2(lme.biped.sub)  #conditional: 0.417, marginal: 0.05  
lme.biped.sub.tukey <- emmeans(lme.biped.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data_omit)
lme.biped.sub.tukey  #no significant differences in substrates

ggplot(lab_data_omit, aes(y=sqrt(bipedal_percent), x=substrate_type)) +
  geom_boxplot() + 
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#substrate type does not affect bipedalism
```

```{r}
#Bipedalism per substrate and sex Histogram
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(bins=10) +
  facet_wrap(~substrate_type + sex) +
  facet_grid(sex ~ substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of bipedal percentage separated into substrate type
summaryBy(bipedal_percent ~ substrate_type + sex, data = lab_data_omit,
          FUN = list(mean, median, min, max))
```

```{r}
#Histogram of bipedal percent broken into substrate type and sex
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent), alpha=sex)) +
  geom_histogram(bins = 20, binwidth = 8, color = "black") +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```

```{r}
#Histogram of bipedal percent broken into substrate type
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent), fill=substrate_type)) +
  geom_histogram(col = "white") + 
  labs(x = "Percent Bipedal") +
  scale_fill_discrete(name = "Substrate Type", labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.background = element_blank())
```

```{r}
#Boxplot of bipedal percent separated by substrate type and sex
ggplot(data = lab_data_omit, aes(substrate_type, as.numeric(bipedal_percent), fill = sex)) +
  geom_boxplot() +
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.background = element_blank()) +
  scale_fill_discrete(name = "Sex", labels = c("Female", "Male")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```



Question 3: Is the pattern observed in question #1 explained by question #2?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners avoid moving on suboptimal parts of habitat.

```{r}
#How often lizards ran on certain substrates
table(fieldspeed$Segment.)                    #total: 46
table(fieldspeed$Substrate.Type == "DEBRIS")  #2  (4.3%)
table(fieldspeed$Substrate.Type == "MIXED")   #12 (26.1%)
table(fieldspeed$Substrate.Type == "SAND")    #30 (65.2%)
table(fieldspeed$Substrate.Type == "")        #2  (4.3%)

#most of lizards' movements are happening on sand, then mixed, and only a few happen on debris
```

```{r}
#Speed vs. Substrate Type 
mcelroy_speed_sub_lme2 <- lme(log10(Speed) ~ Substrate.Type, random = ~1|ID, data = fieldspeed_reduced, na.action=na.omit)
anova(mcelroy_speed_sub_lme2)  #p-value=0.2871  #not significant
mcelroy_speed_sub_lme_tukey2 <- emmeans(mcelroy_speed_sub_lme2, pairwise ~ Substrate.Type, adjust = "tukey", data = fieldspeed_reduced)
mcelroy_speed_sub_lme_tukey2  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme2))
shapiro.test(residuals(mcelroy_speed_sub_lme2))  #normal

anova(lme(Speed ~ Substrate.Type + Sex, random = ~1|ID, data = fieldspeed_reduced, na.action = na.omit))
#Sex doesn't affect model either

ggplot(data = fieldspeed_reduced, aes(x = Substrate.Type, y = Speed)) +
  geom_boxplot() +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#Substrate type doesn't appear to affect speed at all
```

```{r}
#Speed vs. Number Clutter
mcelroy_speed_clutter_lme_log3 <- lme(Speed ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log3)  #p-value=0.0905  #not significant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log3))  #normal
hist(residuals(mcelroy_speed_clutter_lme_log3))
performance::r2(mcelroy_speed_clutter_lme_log3)  #ok  #C=0.2250   #M=0.083

ggplot(fieldspeed, aes(log10(NumberClutter+1), Speed))+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#slight upward trend: as ground clutter increased, speed also increased slightly

#the linear regression line shows a positive relationship between speed and ground clutter croseed, but the ANOVA says it's not significant.
```

```{r}
#Bipedalism's effect on side velocity
side.vmax.biped <- lme(log10(side_vmax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data = lab_data_omit)
anova(side.vmax.biped)  #p-value < 0.0001
hist(residuals(side.vmax.biped))
shapiro.test(residuals(side.vmax.biped))  #normal
performance::r2(side.vmax.biped)  #C=0.304  #M=0.273

ggplot(lab_data_omit, aes(log10(bipedal_percent+1), log10(side_vmax+1))) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Percent Bipedal", y = "Velocity (side) (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#bipedalism does effect velocity in side videos
```

```{r}
#Bipedalism's effect on top velocity
top.vmax.biped <- lme(log10(top_vmax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data = lab_data_omit)
anova(top.vmax.biped)  #p-value = 0.0736  #not significant
hist(residuals(top.vmax.biped))
shapiro.test(residuals(top.vmax.biped))  #normal
performance::r2(top.vmax.biped)  #C=0.425  #M=0.038

ggplot(lab_data_omit, aes(log10(bipedal_percent+1), log10(top_vmax+1))) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Percent Bipedal", y = "Velocity (top) (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#bipedalsim does not effect velocity in top videos
```

```{r}
#Bipedalism's effect on side acceleration
side.amax.biped <- lme(log10(side_amax+1) ~ log10(bipedal_percent+1), random = ~1|ID, data = lab_data_omit)
anova(side.amax.biped)  #p-value=0.5229
hist(residuals(side.amax.biped))
shapiro.test(residuals(side.amax.biped))  #normal
performance::r2(side.amax.biped)  #C=0.119  #M=0.006

#Bipedalism does not effect acceleration in side videos
```



> Racerunner Morphometrics

```{r}
#Mean
mean(Racerunner_demographics$svl)  #mean = 6.32 cm
mean(Racerunner_demographics$tail_length)   #mean = 13.04 cm (including 2 that lost part of tail)
mean(Racerunner_demographics$weight)   #mean = 5.91 g

#Range
range(Racerunner_demographics$svl)  #range = 5.59, 7.80
range(Racerunner_demographics$tail_length)   #range = 4.20, 16.10
range(Racerunner_demographics$weight)   #range = 4.09, 8.76
```

#mean, median & range of demographic data separated by sex
```{r}
#SVL
summaryBy(svl ~ sex, data = Racerunner_demographics,
          FUN = list(mean, median, min, max))
svl.f <- Racerunner_demographics$svl[Racerunner_demographics$sex=="F"]
svl.m <- Racerunner_demographics$svl[Racerunner_demographics$sex=="M"]
t.test(svl.f, svl.m)  #p-value = 0.067  #not significant

ggplot(data = Racerunner_demographics, aes(x = sex, y = svl, fill = sex)) +
  geom_boxplot() +
  labs(x = "Sex", y = "SVL (cm)") +
  scale_x_discrete(labels = c("Female", "Male")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#no significant differences in SVL length between sexes
```

```{r}
#tail length
summaryBy(tail_length ~ sex, data = Racerunner_demographics,
          FUN = list(mean, median, min, max))

f.tail_length_removed <- Racerunner_demographics[-c(12,15),]  #removing data from 2 lizards whose tails were missing

summaryBy(tail_length ~ sex, data = f.tail_length_removed,
          FUN = list(mean, median, min, max))

tail.f <- Racerunner_demographics$tail_length[Racerunner_demographics$sex=="F"]
tail.f2 <- f.tail_length_removed$tail_length[Racerunner_demographics$sex=="F"]
tail.m <- Racerunner_demographics$tail_length[Racerunner_demographics$sex=="M"]
t.test(tail.f, tail.m)  #p-value = 0.01117  #significant
t.test(tail.f2, tail.m)  #p-value = 0.02911  #significant

ggplot(data = f.tail_length_removed, aes(x = sex, y = tail_length, fill = sex)) +
  geom_boxplot() +
  labs(x = "Sex", y = "Tail Length (cm)") +
  scale_x_discrete(labels = c("Female", "Male")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#significant differences in tail length between sexes
```

```{r}
#weight
summaryBy(weight ~ sex, data = Racerunner_demographics,
          FUN = list(mean, median, min, max))
weight.f <- Racerunner_demographics$weight[Racerunner_demographics$sex=="F"]
weight.f2 <- f.tail_length_removed$weight[Racerunner_demographics$sex=="F"]
weight.m <- Racerunner_demographics$weight[Racerunner_demographics$sex=="M"]
t.test(weight.f, weight.m)  #not significant
t.test(weight.f2, weight.m)   #not significant

ggplot(data = f.tail_length_removed, aes(x = sex, y = weight, fill = sex)) +
  geom_boxplot() +
  labs(x = "Sex", y = "Weight (g)") +
  scale_x_discrete(labels = c("Female", "Male")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#no differences in weight beteween sexes
```


```{r}
#Number of Pauses
table(lab_data$pauses_side)
table(lab_data$pauses_top)
```

```{r}
#Tmax

mean(lab_data$side_tmax)  #0.559 sec
range(lab_data$side_tmax)  #min=0.102 sec  #max=1.19 sec

mean(lab_data$top_tmax)  #0.541 sec
range(lab_data$top_tmax)  #min=0.302 sec  #max=1.35 sec

t.test(lab_data$side_tmax, lab_data$top_tmax)  #p-value=0.413
#the difference in time spent in each camera video is not significantly different
```




