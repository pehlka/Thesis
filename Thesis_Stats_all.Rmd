---
title: "Thesis_Stats_all"
author: "Kayla Pehl"
date: "10/29/2020"
output: html_document
---

```{r}
#Loading necessary packages
library(ggplot2)
library(lme4)
library(doBy)
library(car)
library(emmeans)
library(nlme)
library(lmtest)

library(dplyr)
library(tidyverse)
library(forcats)
```

```{r}
#Importing data

#lab_data <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.26.20_removed_non-standstill_starts+NAs+negatives+3lizards.csv")  
  #lab experiment data without no-standstill starts & 3 incomplete lizards
lab_data2 <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_12.04.20_removed_non-standstill_starts+NAs+negatives+3lizards+peak_v_biped.csv")
  #includes peak velocity column and biped total column
lab_data2_omit <- lab_data2[!is.na(lab_data2$bipedal_percent), ]
  #includes peak velocity column and biped total column with non-bipedal rows omitted
#lab_data_omit <- lab_data[!is.na(lab_data$bipedal_percent), ]
  #lab_data without trials that were run quadrupedally with no bipedalism present
fieldspeed <-  read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_11.18.20.csv")
  #final fieldspeed data; double checked with data sheets & it's correct 11.18.20
  #replacing all fieldspeed_final data and McElroy_habitat_data
fieldspeed_reduced <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final_reduced_11.18.20.csv")
  #final fieldspeed data without 2 rows that did not have substrate type listed
field_transect_data_totals <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals.csv") 
  #field transect substrate totals
field_transect_data_totals_condensed <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals_condensed.csv")
  #field transect substrate totals condensed into debris/mixed/vegetation/sand
field_transect_data_totals_heaviness <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_heaviness.csv")
  #field transect susbtrate totals broken into heavy/light/sand
```


Question 1: Do Racerunners use their habitat randomly or non-randomly?
 Ho: Racerunners use their habitat randomly.
 Ha: Racerunners use their habitat non-randomly.

```{r}
#Field Transect Data
field_transect_data_totals  #heavy mixed most common
field_transect_data_totals_condensed  #mixed most common
field_transect_data_totals_heaviness  #heavy derbis/mixed/veg most common
```

```{r}
#bar plot of habitat assessment substrate totals
ggplot(field_transect_data_totals, aes(x=substrate, y=distance_m)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Substrate", y = "Distance (m)") +
  scale_x_discrete(labels = c("Heavy Debris", "Heavy Mixed", "Heavy Vegetation", "Light Debris", "Light Mixed", "Light Vegetation", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"),
        axis.text.x = element_text(angle = 90))

#trying to make a pie chart of substrates in habitat assessment
ggplot(field_transect_data_totals, aes (x="", y = distance_m, fill = substrate)) + 
  geom_col(position = 'stack', width = 1) +
  geom_text(aes(label = percent_type, x = 1.2),
            position = position_stack(vjust = 0.5)) +
  scale_fill_brewer(palette = "Blues", direction = -1) +
  theme(plot.title = element_text(hjust=0.5),
        axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  labs(fill = "Substrate",
       x = NULL,
       y = NULL,
       title = NULL) + 
    coord_polar("y", start = 0) +
  theme_void() 

```





Question 2: How does "available" habitat affect Racerunner locomotion?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners run fastest on sand compared to debris and mixed.



```{r}
#Velocity vs Substrate Type - total
lme.log.side.vmax.sub2 <- lme(log10(peak_v+1) ~ substrate_type + sex, random = ~1|ID, data = lab_data2)
anova(lme.log.side.vmax.sub2)  #p-value substrate=0.0001, significant  #sex insignificant
ggplot(lab_data2, aes(residuals(lme.log.side.vmax.sub2))) + 
  geom_histogram(bins = 11, color = "white") +
  labs(x = "Residuals of lme.log.side.vmax.sub2") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.vmax.sub2))  #normal
summary(lme.log.side.vmax.sub2)
performance::r2(lme.log.side.vmax.sub2)  #C=0.374 #M=0.128
lme.log.side.vmax.sub.tukey2 <- emmeans(lme.log.side.vmax.sub2, pairwise ~ substrate_type, adjust="tukey", data=lab_data2)
lme.log.side.vmax.sub.tukey2  #significant differences between D-S (p<0.0001) and D-SD (p=0.0405), but not S-SD (p=0.0661)

ggplot(lab_data2, aes(y=log10(peak_v+1), x=substrate_type, fill = substrate_type)) +
  geom_boxplot() + 
  scale_fill_brewer(palette = "Blues") +
  labs(x = "Substrate", y = "Peak Velocity (m/s)") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))
```




```{r}
#creating labels for histograms
sex.labs <- c("Female", "Male")
names(sex.labs) <- c("F", "M")
sub.labs <- c("Debris", "Sand", "Mixed")
names(sub.labs) <- c("D", "S", "SD")
```

```{r}
#Peak Velocity vs Substrate Type 
ggplot(data = lab_data2, aes(peak_v))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = "Peak Velocity (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of top max velocity separated into substrate types
summaryBy(peak_v ~ substrate_type, data = lab_data2,
          FUN = list(mean, median, min, max))
```


```{r}
#Acceleration vs Substrate Type - Side
lme.log.side.amax.sub <- lme(log10(side_amax+1) ~ substrate_type + sex, random = ~1|ID, data = lab_data2)
anova(lme.log.side.amax.sub)  #p-value substrate & sex = not significant
ggplot(lab_data2, aes(residuals(lme.log.side.amax.sub))) + 
  geom_histogram(bins = 8, color = "white") +
  labs(x = "Residuals of lme.log.side.amax.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.amax.sub))  #normal
summary(lme.log.side.amax.sub)
performance::r2(lme.log.side.amax.sub)   #C=0.047  #M=0.002
lme.log.side.amax.sub.tukey <- emmeans(lme.log.side.amax.sub, pairwise ~ substrate_type, adjust="tukey", 
                                       data=lab_data2)
lme.log.side.amax.sub.tukey  #no significant differences in any substrate's acceleration

ggplot(lab_data2, aes(y=log10(side_amax+1), x=substrate_type, fill = substrate_type)) +
  geom_boxplot() + 
  scale_fill_brewer(palette = "Blues") +
  labs(x = "Substrate", y = bquote('Peak Acceleration' ~ (m^2/s))) +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

#low R2s make sense because the model shows that susbtrate type doesn't affect acceleration, which means that substrate type should not explain a high percentage of changes in the data

#substrate does not affect acceleration in side videos
```

```{r}
#Acceleration vs Substrate Type - Side
ggplot(data = lab_data2, aes(side_amax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = bquote('Acceleration' ~ (m^2/s))) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of side_amax data separated into substrate types
summaryBy(side_amax ~ substrate_type, data = lab_data2,
          FUN = list(mean, median, min, max))
```

```{r}
#Bipedalism vs Substrate Type
lme.biped.sub <- lme(sqrt(bipedal_percent) ~ substrate_type + sex, random = ~1|ID, data = lab_data2_omit)
anova(lme.biped.sub)  #p-value substrate=0.0513  #barely not significant   #sex insignificant
ggplot(lab_data2_omit, aes(residuals(lme.biped.sub))) + 
  geom_histogram(bins = 7, color = "white") +
  labs(x = "Residuals of lme.biped.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.biped.sub))   #normal
summary(lme.biped.sub)
performance::r2(lme.biped.sub)  #conditional: 0.426, marginal: 0.072  
lme.biped.sub.tukey <- emmeans(lme.biped.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data2_omit)
lme.biped.sub.tukey  #no significant differences in substrates

ggplot(lab_data2_omit, aes(y=sqrt(bipedal_percent), x=substrate_type, fill = substrate_type)) +
  geom_boxplot() + 
  scale_fill_brewer(palette = "Blues") +
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

#substrate type does not affect bipedalism
```

```{r}
#Bipedalism per substrate and sex Histogram
ggplot(data = lab_data2_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(bins=10) +
  facet_wrap(~substrate_type + sex) +
  facet_grid(sex ~ substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#mean, median & range of bipedal percentage separated into substrate type
summaryBy(bipedal_percent ~ substrate_type + sex, data = lab_data2_omit,
          FUN = list(mean, median, min, max))
```

```{r}
#Histogram of bipedal percent broken into substrate type and sex
ggplot(data = lab_data2_omit, aes(as.numeric(bipedal_percent), alpha=sex)) +
  geom_histogram(bins = 20, binwidth = 8, color = "black") +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```

```{r}
#Histogram of bipedal percent broken into substrate type
ggplot(data = lab_data2_omit, aes(as.numeric(bipedal_percent), fill=substrate_type)) +
  geom_histogram(col = "white") + 
  labs(x = "Percent Bipedal") +
  scale_fill_discrete(name = "Substrate Type", labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.background = element_blank())
```

```{r}
#Boxplot of bipedal percent separated by substrate type and sex
ggplot(data = lab_data2_omit, aes(substrate_type, as.numeric(bipedal_percent), fill = sex)) +
  geom_boxplot() +
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Mixed")) +
  theme(panel.background = element_blank()) +
  scale_fill_discrete(name = "Sex", labels = c("Female", "Male")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```



Question 3: Is the pattern observed in question #1 explained by question #2?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners avoid moving on suboptimal parts of habitat.

```{r}
#How often lizards ran on certain substrates
table(fieldspeed$Segment.)                    #total: 46
table(fieldspeed$Substrate.Type == "DEBRIS")  #2  (4.3%)
table(fieldspeed$Substrate.Type == "MIXED")   #12 (26.1%)
table(fieldspeed$Substrate.Type == "SAND")    #30 (65.2%)
table(fieldspeed$Substrate.Type == "")        #2  (4.3%)

#most of lizards' movements are happening on sand, then mixed, and only a few happen on debris
```

```{r}
#bar plot of field data substrate totals
ggplot(fieldspeed_reduced, aes(x=Substrate.Type, y=Distance)) +
  geom_bar(stat = "identity", fill = "steelblue", width = 0.5) +
  labs(x = "Substrate", y = "Distance (m)") +
  #scale_x_discrete(labels = c("Heavy Debris", "Heavy Mixed", "Heavy Vegetation", "Light Debris", "Light Mixed", "Light Vegetation", "Sand")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"),
        axis.text.x = element_text(angle = 90))
```


```{r}
#Speed vs. Substrate Type 
mcelroy_speed_sub_lme2 <- lme(log10(Speed) ~ Substrate.Type + Sex, random = ~1|ID, 
                              data = fieldspeed_reduced, na.action=na.omit)
anova(mcelroy_speed_sub_lme2)  #p-value substrate & sex = insignificant
summary(mcelroy_speed_sub_lme2)
mcelroy_speed_sub_lme_tukey2 <- emmeans(mcelroy_speed_sub_lme2, pairwise ~ Substrate.Type, adjust = "tukey", 
                                        data = fieldspeed_reduced)
mcelroy_speed_sub_lme_tukey2  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme2))
shapiro.test(residuals(mcelroy_speed_sub_lme2))  #normal
performance::r2(mcelroy_speed_sub_lme2)

ggplot(data = fieldspeed_reduced, aes(x = Substrate.Type, y = Speed, fill = Substrate.Type)) +
  geom_boxplot() +
  scale_fill_brewer(palette = "Blues") +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5),
        axis.text = element_text(face = "bold"))

#Substrate type doesn't appear to affect speed at all
```


```{r}
#Speed vs. Number Clutter
mcelroy_speed_clutter_lme_log3 <- lme(Speed ~ log10(NumberClutter+1) + Sex, random = ~1|ID, data = fieldspeed, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log3)  #p-value clutter & sex = insignificant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log3))  #normal
hist(residuals(mcelroy_speed_clutter_lme_log3))
performance::r2(mcelroy_speed_clutter_lme_log3)  #ok  #C=0.265   #M=0.086

ggplot(fieldspeed, aes(log10(NumberClutter+1), Speed))+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"),
        axis.text = element_text(face = "bold"))

#slight upward trend: as ground clutter increased, speed also increased slightly, but insignificantly

#the linear regression line shows a positive relationship between speed and ground clutter croseed, but the ANOVA says it's not significant.
```

```{r}
#Bipedalism's effect on peak velocity 
peakv.biped <- lme(log10(peak_v+1) ~ log10(bipedal_percent+1) + sex, random = ~1|ID, data = lab_data2_omit)
anova(peakv.biped)  #p-value substrate=0.0655, insignificant   #sex = insignificant
hist(residuals(peakv.biped))
shapiro.test(residuals(peakv.biped))  #normal
performance::r2(peakv.biped)  #C=0.419  #M=0.075

ggplot(lab_data2_omit, aes(log10(bipedal_percent+1), log10(peak_v+1))) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Percent Bipedal", y = "Peak Velocity (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"),
        axis.text = element_text(face = "bold"))

#bipedalism does not affect peak velocity
```

```{r}
#where did peak velocity occur (side or top camera)
table(lab_data2$peak_v_cam)

14/139 #10.0%
125/139 #90.0%
#side (1) cam had peak velocity 14 times
#top (2) cam had peak velocity 125 times
```


```{r}
#Bipedalism's effect on side acceleration
side.amax.biped <- lme(log10(side_amax+1) ~ log10(bipedal_percent+1) + sex, random = ~1|ID, data = lab_data2_omit)
anova(side.amax.biped)  #p-value substrate & sex = insignificant
hist(residuals(side.amax.biped))
shapiro.test(residuals(side.amax.biped))  #normal
performance::r2(side.amax.biped)  #C=0.130  #M=0.005

#Bipedalism does not effect acceleration in side videos
```


```{r}
#Number of Pauses
table(lab_data2$pauses_side)
table(lab_data2$pauses_top)
```

```{r}
#Tmax

mean(lab_data2$side_tmax)  #0.559 sec
range(lab_data2$side_tmax)  #min=0.102 sec  #max=1.19 sec

mean(lab_data2$top_tmax)  #0.541 sec
range(lab_data2$top_tmax)  #min=0.302 sec  #max=1.35 sec

t.test(lab_data2$side_tmax, lab_data2$top_tmax)  #p-value=0.413
#the difference in time spent in each camera video is not significantly different
```

```{r}
table(lab_data2$bipedal_quad_side)  #total = 139
#sum(lab_data$bipedal_side)
#sum bipedal_side = 5390 frames bipedal
table(lab_data2$bipedal_quad_top)  #total = 139
#sum(lab_data$bipedal_top)
#sum bipedal_top = 6982 frames bipedal
```

```{r}
#amount of obstacles crossed in fieldspeed data
summary(fieldspeed$NumberClutter==0)
summary(fieldspeed$NumberClutter==1)
#0 obstacles = 13
#1 obstacle = 3
#>1 obstacle = 30

mean(fieldspeed$NumberClutter)
#mean clutter per movement = 3.56
mean(fieldspeed$Distance)
#mean distance per movement = 1.183 m

3.56/1.183  #3.01 obstacles per meter
```


