---
title: "Thesis_Stats_all"
author: "Kayla Pehl"
date: "10/29/2020"
output: html_document
---

```{r}
#Loading necessary packages
library(ggplot2)
#library(rcompanion)
library(lme4)
#library(sjstats)
library(doBy)
#library(car)
library(emmeans)
#library(multcompView)
library(nlme)
library(lmtest)
```

```{r}
#Importing data
lab_data <- read.csv("~/College of Charleston/Thesis/Videos Digitized/Thesis_videos_digitized_condensed_final_10.26.20_removed_non-standstill_starts+NAs+negatives+3lizards.csv")  
  #lab experiment data without no-standstill starts & 3 incomplete lizards
lab_data_omit <- lab_data[!is.na(lab_data$bipedal_percent), ]
  #lab_data without trials that were run quadrupedally with no bipedalism present
McElroy_habitat_data <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/McElroy_Habitat_Data2.csv")
  #McElroy & McBrayer habitat data from 2018-2019
field_transect_data_totals <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals.csv") 
  #field transect substrate totals
field_transect_data_totals_condensed <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_Totals_condensed.csv")
  #field transect substrate totals condensed into debris/mixed/vegetation/sand
field_transect_data_totals_heaviness <- read.csv("~/College of Charleston/Thesis/Data/Field Transects/Field_Transects_Substrate_heaviness.csv")
  #field transect susbtrate totals broken into heavy/light/sand
fieldspeed_final <- read.csv("~/College of Charleston/Thesis/Data/McElroy Habitat Data/fieldspeed_final.csv")
  #McElroy & McBrayer habitat data from 2018-2019 with substrates crossed listed
```



Question 1: Do Racerunners use their habitat randomly or non-randomly?
 Ho: Racerunners use their habitat randomly.
 Ha: Racerunners use their habitat non-randomly.
 
```{r}
#Ground Clutter Crossed vs. Speed

log.speed.clutter <- lme(log10(speed) ~ log10(ground_clutter_crossed+1), random= ~1|Ã¯..ID, data = McElroy_habitat_data, na.action=na.omit)
anova(log.speed.clutter)   #p-value = 0.0412  #significant
hist(residuals(log.speed.clutter))
shapiro.test(residuals(log.speed.clutter))  #normal  
performance::r2(log.speed.clutter)  #C=0.354 #M=0.124 

ggplot(McElroy_habitat_data, aes(log10(ground_clutter_crossed+1), log10(speed)) )+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
``` 

```{r}
#Field Transect Data
field_transect_data_totals  #heavy mixed most common
field_transect_data_totals_condensed  #mixed most common
field_transect_data_totals_heaviness  #heavy derbis/mixed/veg most common
```





Question 2: How does "available" habitat affect Racerunner locomotion?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners run fastest on sand compared to debris and sand/debris.

```{r}
#Velocity vs Substrate Type - Side
lme.log.side.vmax.sub <- lme(log10(side_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.side.vmax.sub)  #p-value=0.0028  #significant
ggplot(lab_data, aes(residuals(lme.log.side.vmax.sub))) + 
  geom_histogram(bins = 11, color = "white") +
  labs(x = "Residuals of lme.log.side.vmax.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.vmax.sub))  #normal (but just barely)
summary(lme.log.side.vmax.sub)
performance::r2(lme.log.side.vmax.sub)  #C=0.395 #M=0.056
lme.log.side.vmax.sub.tukey <- emmeans(lme.log.side.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.side.vmax.sub.tukey  #significant differences between D-S but not D-SD or S-SD
ggplot(lab_data, aes(y=log10(side_vmax+1), x=substrate_type)) +
  geom_boxplot() + 
  labs(x = "Substrate", y = "Velocity (side camera) (m/s)") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```

```{r}
#Side max velocity per substrate 
ggplot(data = lab_data, aes(side_vmax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = "Velocity (Side Camera) (m/s)") +
  theme(axis.title.x = element_text(face = "bold"))

#mean, median & range of top max velocity separated into substrate types
summaryBy(side_vmax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Velocity vs Substrate Type - Top

lme.log.top.vmax.sub <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.top.vmax.sub)  #p-value=0.0004  #significant
hist(residuals(lme.log.top.vmax.sub))
shapiro.test(residuals(lme.log.top.vmax.sub))  # not normal
summary(lme.log.top.vmax.sub)
performance::r2(lme.log.top.vmax.sub)  #pretty low R2s
lme.log.top.vmax.sub.tukey <- emmeans(lme.log.top.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.top.vmax.sub.tukey  #no significant differences between substrates

#DATA IS NOT NORMAL -- TRANSFORM
#data isn't normal without log10, with log10

lme.top.vmax.sub <- lme(log10(top_vmax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.top.vmax.sub)  #p-value=0.0004  #significant
hist(residuals(lme.log.top.vmax.sub))
shapiro.test(residuals(lme.top.vmax.sub))  # not normal
summary(lme.top.vmax.sub)
performance::r2(lme.top.vmax.sub)  #pretty low R2s
lme.top.vmax.sub.tukey <- emmeans(lme.top.vmax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.top.vmax.sub.tukey  #no significant differences between substrates

#LOOK BACK AT!!!!!!!!!!!!!!!!!!!!!!!!!1

```

```{r}
#Top max velocity per substrate 
ggplot(data = lab_data, aes(top_vmax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = "Velocity (Top Camera) (m/s)")

#mean, median & range of top max velocity separated into substrate types
summaryBy(top_vmax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Acceleration vs Substrate Type - Side
lme.log.side.amax.sub <- lme(log10(side_amax+1) ~ substrate_type, random = ~1|ID, data = lab_data)
anova(lme.log.side.amax.sub)  #p-value=0.8411  #not significant
ggplot(lab_data, aes(residuals(lme.log.side.amax.sub))) + 
  geom_histogram(bins = 8, color = "white") +
  labs(x = "Residuals of lme.log.side.amax.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.log.side.amax.sub))  #normal
summary(lme.log.side.amax.sub)
performance::r2(lme.log.side.amax.sub)   #C=0.047  #M=0.002
lme.log.side.amax.sub.tukey <- emmeans(lme.log.side.amax.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data)
lme.log.side.amax.sub.tukey  #no significant differences in any substrate's acceleration
ggplot(lab_data, aes(y=log10(side_amax+1), x=substrate_type)) +
  geom_boxplot() + 
  labs(x = "Substrate", y = "Acceleration (side camera) (m^2/s)") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))

#low R2s make sense because the model shows that susbtrate type doesn't affect acceleration, which means that substrate type should not explain a high percentage of changes in the data
```

```{r}
#Side max acceleration per substrate 
ggplot(data = lab_data, aes(side_amax))  + 
  geom_histogram(bins = 8) +
  facet_wrap(~substrate_type) +
    facet_grid(~substrate_type,
             labeller = labeller(substrate_type=sub.labs)) +
  labs(x = bquote('Acceleration (Side Camera)' ~ (m^2/s)))

#mean, median & range of side_amax data separated into substrate types
summaryBy(side_amax ~ substrate_type, data = lab_data,
          FUN = list(mean, median, min, max))
```

```{r}
#Bipedalism vs Substrate Type
lme.biped.sub <- lme(sqrt(bipedal_percent) ~ substrate_type, random = ~1|ID, data = lab_data_omit)
anova(lme.biped.sub)  #p-value=0.0512  #barely not significant
ggplot(lab_data_omit, aes(residuals(lme.biped.sub))) + 
  geom_histogram(bins = 7, color = "white") +
  labs(x = "Residuals of lme.biped.sub") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))
shapiro.test(residuals(lme.biped.sub))   #normal
summary(lme.biped.sub)
performance::r2(lme.biped.sub)  #conditional: 0.417, marginal: 0.05  
lme.biped.sub.tukey <- emmeans(lme.biped.sub, pairwise ~ substrate_type, adjust="tukey", data=lab_data_omit)
lme.biped.sub.tukey  #no significant differences in substrates
ggplot(lab_data_omit, aes(y=sqrt(bipedal_percent), x=substrate_type)) +
  geom_boxplot() + 
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```
#check back over - p-value barely insignificant


> Bipedalism on difference substrates

```{r}
#creating labels for histograms
sex.labs <- c("Female", "Male")
names(sex.labs) <- c("F", "M")
sub.labs <- c("Debris", "Sand", "Sand/Debris")
names(sub.labs) <- c("D", "S", "SD")

#Bipedalism per substrate and sex Histogram
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent)))  + 
  geom_histogram(bins=10) +
  facet_wrap(~substrate_type + sex) +
  facet_grid(sex ~ substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal")

#mean, median & range of bipedal percentage separated into substrate type
summaryBy(bipedal_percent ~ substrate_type + sex, data = lab_data_omit,
          FUN = list(mean, median, min, max))
```


```{r}
#Histogram of bipedal percent broken into substrate type and sex
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent), alpha=sex)) +
  geom_histogram(bins = 20, binwidth = 8, color = "black") +
  facet_wrap(~substrate_type) +
  facet_grid(~substrate_type,
             labeller = labeller(sex=sex.labs, substrate_type=sub.labs)) +
  labs(x = "Percent Bipedal") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```


```{r}
#Histogram of bipedal percent broken into substrate type
ggplot(data = lab_data_omit, aes(as.numeric(bipedal_percent), fill=substrate_type)) +
  geom_histogram(col = "white") + 
  labs(x = "Percent Bipedal") +
  scale_fill_discrete(name = "Substrate Type", labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.background = element_blank())
```


```{r}
#Boxplot of bipedal percent separated by substrate type and sex
ggplot(data = lab_data_omit, aes(substrate_type, as.numeric(bipedal_percent), fill = sex)) +
  geom_boxplot() +
  labs(x = "Substrate", y = "Percent Bipedal") +
  scale_x_discrete(labels = c("Debris", "Sand", "Sand/Debris")) +
  theme(panel.background = element_blank()) +
  scale_fill_discrete(name = "Substrate Type", labels = c("Female", "Male")) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```



Question 3: Is the pattern observed in question #1 explained by question #2?
 Ho: Racerunners run the same on all substrates.
 Ha: Racerunners avoid moving on suboptimal parts of habitat.

```{r}
#How often lizards ran on certain substrates
table(fieldspeed_final$Segment.)                    #total: 46
table(fieldspeed_final$Substrate.Type == "DEBRIS")  #2  (4.3%)
table(fieldspeed_final$Substrate.Type == "MIXED")   #12 (26.1%)
table(fieldspeed_final$Substrate.Type == "SAND")    #30 (65.2%)
table(fieldspeed_final$Substrate.Type == "")        #2  (4.3%)

#most of lizards' movements are happening on sand, then mixed, and only a few happen on debris
```

```{r}
#Speed vs. Substrate Type 
mcelroy_speed_sub_lme <- lme(Speed ~ Substrate.Type, random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_speed_sub_lme)  #p-value=0.3845  #not significant
mcelroy_speed_sub_lme_tukey <- emmeans(mcelroy_speed_sub_lme, pairwise ~ Substrate.Type, adjust = "tukey", data = fieldspeed_final)
mcelroy_speed_sub_lme_tukey  #no substrates are signficant
hist(residuals(mcelroy_speed_sub_lme))
shapiro.test(residuals(mcelroy_speed_sub_lme))  #normal

anova(lme(Speed ~ Substrate.Type + Sex, random = ~1|ID, data = fieldspeed_final, na.action = na.omit))
#Sex doesn't affect model either

ggplot(data = fieldspeed_final, aes(x = Substrate.Type, y = Speed)) +
  geom_boxplot() +
  labs(x = "Substrate Type", y = "Speed (m/s)") +
  scale_x_discrete(labels = c("Debris", "Mixed", "Sand")) +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
#Substrate type doesn't appear to affect speed at all
```

```{r}
#Speed vs. Number Clutter
mcelroy_speed_clutter_lme_log3 <- lme(Speed ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_speed_clutter_lme_log3)  #p-value=0.0703  #not significant
shapiro.test(residuals(mcelroy_speed_clutter_lme_log3))  #normal
hist(residuals(mcelroy_speed_clutter_lme_log3))
performance::r2(mcelroy_speed_clutter_lme_log3)  #ok  #C=0.290   #M=0.102

ggplot(fieldspeed_final, aes(log10(NumberClutter+1), Speed))+
  geom_point() + 
  geom_smooth(method = 'lm') +
  labs(x = "Ground Clutter Crossed", y = "Speed (m/s)") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_blank(), 
        axis.line = element_line(color = "black"))

#slight upward trend: as ground clutter increased, speed also increased slightly
```

```{r}
#Distance vs. Number Clutter 
mcelroy_dist_clutter_lme3 <- lme(log10(Distance) ~ log10(NumberClutter+1), random = ~1|ID, data = fieldspeed_final, na.action = na.omit)
anova(mcelroy_dist_clutter_lme3)  #p-value=0.0137  #significant
shapiro.test(residuals(mcelroy_dist_clutter_lme3))  #normal
hist(residuals(mcelroy_dist_clutter_lme3))
performance::r2(mcelroy_dist_clutter_lme3)  #good  #C=0.586  #M=0.154

ggplot(fieldspeed_final4, aes(log10(NumberClutter+1), log10(Distance))) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Number of Clutter Crossed", y = "Distance Traveled (m)") +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
#trying to get dots to color-coordinate with ID, but when I put col=ID after Distance in aes, it messes up the lm line
```

```{r}
#Speed vs. Distance
mcelroy_dist_speed_lme <- lme(log10(Speed) ~ log10(Distance), random = ~1|ID, data = fieldspeed_final, na.action=na.omit)
anova(mcelroy_dist_speed_lme)  #p-value=0.0001  #significant
shapiro.test(residuals(mcelroy_dist_speed_lme))   #normal
hist(residuals(mcelroy_dist_speed_lme))
performance::r2(mcelroy_dist_speed_lme)  #good  #C=0.702  #M=0.449

ggplot(fieldspeed_final, aes(log10(Distance), log10(Speed))) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Distance (m)", y = "Speed (m/s)") +
  theme(panel.background = element_blank()) +
  theme(axis.line.x = element_line(color = "black", size = 0.5),
        axis.line.y = element_line(color = "black", size = 0.5))
```









